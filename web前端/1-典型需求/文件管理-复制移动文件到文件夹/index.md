# 分析过程

【空间的文件管理模块】

- 需求：
  - 新增迭代视图，之前只是文件夹视图
  - **【新增文件/文件夹复制/移动到目标文件夹】需求 A** ，之前只有文件的上传、更新、下载和文件/文件夹的删除
    - 类似 Mac 电脑文件夹操作的 UI 交互

对需求 A 分解、分析过程如下：

- **弹窗功能**：**把弹窗外选择的多个文件/文件夹 复制移动 到某个空间的某个文件夹节点**
- **界面交互**：

  - 弹窗左侧是空间列表，进来默认选中当前空间，左侧区域按区块分为以下四种

    - 搜索并点击过的空间：input 输入框搜索并选中某个空间之后才有这个区域，最多保存最新的五条
    - 当前空间
    - 收藏空间
    - 参与空间

  - 空间列表选中某个空间，弹窗右侧目录区域（固定宽度父容器，水平排列固定宽度的各层目录子盒子）则请求展示该空间的根目录（类似树的 root 节点）下的文件/文件夹信息列表，即第一层目录，记为 A 层目录
    - 点击选中 A 层目录的信息列表中的某个文件夹 a1，则右侧新增一层目录，请求展示 a1 下的文件/文件夹信息列表，即第二层目录，记为 B 层目录
    - 再点击选中 B 层目录的信息列表中的某个文件夹 b1，则右侧新增一层目录，请求展示 b1 下的文件/文件夹信息列表，即第三层目录，记为 C 层目录
    - 以此类推下去
  - 每一层目录都有新建文件夹 Icon，点击则在当前层的目录新建一个指定名称的文件夹，并刷新当前层的目录

- **状态管理**

  - `folderColumnList`：点击直到展示第 N 层目录，存储前 N 层目录对应的文件夹节点信息，默认是`[{id: root}]`，即根目录
    - 数组每个元素映射一个`<FolderColumn />`组件实例： 展示文件夹节点 Node 对应的某一层目录下的文件/文件夹信息列表
      - `useEffect` 中根据传入组件的空间 id 和 文件夹节点信息的 id，获取 Node 文件夹节点下的文件/文件夹信息
    - 点击直到展示第 N 层目录，前面 N-1 层目录的内容列表中都有一个选中状态样式的文件夹，也是根据`folderColumnList`来判断的
  - `selectedFolderItem`: 当前选中的文件夹节点，有值则弹窗底部确认按钮可点击

- **细节**

  - 文件/文件夹有个 `disabled` 样式，不能点击选中，包含情况：
    - 选中的文件/文件夹不能移动/复制到文件，只能到文件夹
    - 选中的文件夹不能移动/复制到自身
    - 最后一层目录要自动滚到视区，即贴着父容器右边界

- **难点**

  - 没有 UI 交互：参考对标产品 `Teambition` 的交互
  - 文件夹区域没有头绪：因为之前只做过简单的文件的上传、更新、删除，这种交互复杂的文件/文件夹复制移动没有做过

- **实现过程**

  - ==【重复则抽象复用】==
  - ==**每一层目录包含文件/文件夹的数据格式、功能、UI 交互完全一样 === 每一层目录对应一个组件实例`<FolderColumn />`**==

    - 组件内部根据传入组件的空间 id 和 文件夹节点信息的 id 请求展示该文件夹节点对应的目录下的文件/文件夹信息列表，推导出入参如下面代码

```tsx
export interface IFolderColumnItemProps {
  // 分析过程推导出的入参
  projectId?: string; // 当前选择空间的 id
  index: number; // 下标
  item?: IFolderColumnItem; // 文件夹节点
  selectedFolderItem: IFolderColumnItem | null; // 当前选中的文件夹节点
  activeFolderItems: IFolderColumnItem[]; // 就是folderColumnList，具体见源码
  onSelectFolderItem: (item: IFolderColumnItem, index: number) => void; // 点击当前层目录下某个文件夹的回调
  // 其它入参
  isLastItem: boolean; // 是否是 folderColumnList 最后一个元素
  folderResources: IResource[]; // 要被移动/复制的文件夹资源
}
```

# 总结

- 文件夹管理文件/文件夹就是个树形结构，此 UI 就是把树形结构数据映射成水平的一个个文件夹层级目录。
- **跟选择省市区县级联选择器思路一样**
  - 空间：等同于国家
  - 第一层目录：省列表
  - 第二层目录：市列表
  - 第三层目录：区县列表

# UI

![](../imgs/typical-needs-file-copy-move-to-folder1.png)
