# **åŸºæœ¬**

## ä¸ºä»€ä¹ˆå­¦ä¹  webpack

> è¿˜éœ€è¦å¯¹åº”ç”¨è¿›è¡Œæ‰“åŒ…ã€å‹ç¼©å’Œç¼–è¯‘æˆæµè§ˆå™¨èƒ½å¤Ÿç†è§£çš„ä»£ç 

éšç€å‰ç«¯é¡¹ç›®è¶Šæ¥è¶Šå¤æ‚ï¼Œå•ç‹¬å»ºå‡ ä¸ªæ–‡ä»¶ HTMLï¼ŒJSï¼ŒCSS æ¥å†™ä¸šåŠ¡ä»£ç ï¼Œ==è¿™æ ·çš„æ–¹å¼å·²ç»æ— æ³•ä¿è¯é¡¹ç›®çš„å¯ç»´æŠ¤æ€§äº†==ã€‚

==æ‰€ä»¥å°±éœ€è¦å°†ä¸åŒçš„ä¸šåŠ¡åœºæ™¯æ‹†æˆæ¨¡å—==ï¼Œç„¶åå»åˆ†å¼€å¼•å…¥è¿™äº›æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è‡ªå·±åšè‡ªå·±çš„äº‹æƒ…ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯é¡¹ç›®çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§äº†ï¼Œ

ä½†æ˜¯ï¼Œå‡å¦‚ä½ æœ‰å‡ åƒä¸ªæ¨¡å—ï¼Œé‚£èƒ½åœ¨é¡µé¢ä¸Šå¼•å…¥å‡ åƒä¸ª js æ–‡ä»¶å˜›ï¼Ÿæ‰€ä»¥å½“é¡¹ç›®å¤§åˆ°è¿™ä¸ªç¨‹åº¦çš„æ—¶å€™ï¼Œ==å°±å¾—å€ŸåŠ©å·¥å…·æ¥ç®¡ç†è¿™äº›æ¨¡å—äº†ã€‚Webpack å°±æ˜¯è¿™æ ·çš„ä¸€ç§å·¥å…·ï¼Œå¸®åŠ©æˆ‘ä»¬ç®¡ç†å¤æ‚é¡¹ç›®çš„ä¸€ä¸ªå·¥å…·==ã€‚

ä¸ webpack ç±»ä¼¼ï¼Œè¿˜æœ‰å¾ˆå¤šç›¸ä¼¼çš„å·¥å…·ã€‚å¦‚ gulpã€gruntã€browserify. ä½†æ˜¯è¿™ä¸¤å¹´ Webpack çš„ä½¿ç”¨ç‡ç›´çº¿ä¸Šå‡ï¼Œ==æ¯”å¦‚ä¸‰å¤§æ¡†æ¶çš„è„šæ‰‹æ¶å·¥å…·éƒ½å¼€å§‹ä½¿ç”¨ webpack æ¥åšåº•å±‚ä»£ç çš„æ„å»º==ã€‚è¿™å¾—ç›Šäº webpack å¯ä»¥æä¾›å…¶ä»–å·¥å…·æ— æ³•å®ç°çš„ç‰¹æ€§ã€‚æ¯”å¦‚ï¼šTree Shakingï¼Œä»£ç æ‡’åŠ è½½ï¼Œä»£ç åˆ†å‰²ã€‚ã€‚ã€‚

å¦‚æœä½ ä¸ä¼šä½¿ç”¨ webpackï¼Œå†™ä¸šåŠ¡ä»£ç æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ å­¦ä¼šäº† webpackï¼Œ==ä½ ä¼šä»æ›´æ·±å±‚å»æ€è€ƒå‰ç«¯å·¥ç¨‹åŒ–çš„å†…å®¹ï¼Œä¹Ÿèƒ½å‘ç°åœ¨ä»£ç çš„èƒŒåï¼Œåˆ«æœ‰æ´å¤©ã€‚ä½¿ç”¨ webpack å°†æå¤§çš„æ‰©å±•ä½ çš„å‰ç«¯å¼€å‘è§†é‡==ã€‚

Webpack4 ç›¸å¯¹äºä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæœ‰äº†è¾ƒå¤šçš„å˜åŒ–ï¼Œ

- å®ƒçš„é€Ÿåº¦æ›´å¿«äº†ï¼Œåœ¨å¤§å‹é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œwebpack4 ç”šè‡³å¯ä»¥èŠ‚çº¦ 90%çš„æ„å»ºæ—¶é—´ã€‚
- å†…ç½®äº†è·Ÿå¤šçš„é»˜è®¤é…ç½®ï¼Œå˜æ›´äº†è®¸å¤š APIã€‚

## å¸¸ç”¨å‘½ä»¤

![](./imgs/basic-command.png)

**å…¶å®ƒå‘½ä»¤ï¼š**

- yarn æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬
  `npm view yarn versions`

- yarn æ›´æ–°åˆ°æœ€æ–°ç‰ˆ
  `npm install yarn@latest -g`

- yarn å‡çº§æŒ‡å®šç‰ˆæœ¬
  `yarn upgrade v1.21.3`

- `npm install / yarn`: å®‰è£…ä¾èµ–
  åˆ é™¤ node_modules æ–‡ä»¶å¤¹åï¼Œé‡æ–°å®‰è£…ä¾èµ–åŒ…

## å¸¸ç”¨ç®€å†™

- `npm install = npm i`
  åœ¨ git clone é¡¹ç›®çš„æ—¶å€™ï¼Œé¡¹ç›®æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰ node_modules æ–‡ä»¶å¤¹ï¼Œé¡¹ç›®çš„ä¾èµ–æ–‡ä»¶å¯èƒ½å¾ˆå¤§ã€‚ç›´æ¥æ‰§è¡Œï¼Œnpm ä¼šæ ¹æ® package.json é…ç½®æ–‡ä»¶ä¸­çš„ä¾èµ–é…ç½®ä¸‹è½½å®‰è£…ã€‚

- `-global = -g`
  å…¨å±€å®‰è£…ï¼Œå®‰è£…åçš„åŒ…ä½äºç³»ç»Ÿé¢„è®¾ç›®å½•ä¸‹

- `--save = -S`
  å®‰è£…çš„åŒ…å°†å†™å…¥ package.json é‡Œé¢çš„ dependenciesï¼Œ
  ==dependenciesï¼šç”Ÿäº§ç¯å¢ƒéœ€è¦ä¾èµ–çš„åº“==ï¼Œdependencies ä¸­è®°å½•çš„éƒ½æ˜¯é¡¹ç›®åœ¨çº¿ä¸Šè¿è¡Œæ—¶éœ€è¦çš„æ–‡ä»¶
- `--save-dev = -D`
  å®‰è£…çš„åŒ…å°†å†™å…¥ packege.json é‡Œé¢çš„ devDependenciesï¼Œ
  ==devdependenciesï¼šåªæœ‰å¼€å‘ç¯å¢ƒä¸‹éœ€è¦ä¾èµ–çš„åº“==, devDependencies ä¸­è®°å½•çš„æ˜¯é¡¹ç›®åœ¨å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨çš„ä¸€äº›æ–‡ä»¶ï¼Œåœ¨é¡¹ç›®æœ€ç»ˆè¿è¡Œæ—¶æ˜¯ä¸éœ€è¦çš„

## å®‰è£…æŒ‡å®šç‰ˆæœ¬åŒ…

```powershell
npm install --save-dev webpack@<version>
```

- taro å®‰è£…å®ä¾‹
  å¦‚ä¸‹ï¼Œtaro å…¨å±€å®‰è£…å `npm install -g @tarojs/cli`ã€‚å‘ç°ç‰ˆæœ¬ä¸å¯¹ï¼Œå°±å…ˆå¸è½½åŒ…ï¼Œå†è£…æŒ‡å®šç‰ˆæœ¬

```powershell
npm uninstall @tarojs/cli -g
npm install @tarojs/cli@1.3.11 -g
```

- æ–°é¡¹ç›®å†…å®‰è£…è€ç‰ˆæœ¬çš„ webpackï¼Œå¦‚ webpack4.16.5ï¼Œ
  ==è¿™ç§é¡¹ç›®å†…å®‰è£… webpack çš„æ–¹å¼ä½¿å¾—æˆ‘ä»¬å®ç°äº†åœ¨ä¸åŒé¡¹ç›®ä¸­ä½¿ç”¨ä¸åŒçš„ webpack ç‰ˆæœ¬==

```powershell
npm install webpack@4.16.5 webpack-cli -D
```

## å…¶å®ƒ

### 1ã€æŸ¥ webpack ç‰ˆæœ¬å·

```powershell
npm info webpack
```

![](./imgs/npm-info-webpack.png)

è¾“å…¥`webpack-v` æ˜¯åˆ°å…¨å±€é‡Œå»æ‰¾ï¼Œç„¶è€Œæˆ‘æ˜¯å®‰è£…åœ¨é¡¹ç›®é‡Œé¢ï¼Œæ‰€ä»¥æ‰¾ä¸åˆ°è¿™ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œnode æä¾›äº† npx æ¥è¿è¡Œ webpackï¼Œå³ `npx webpack -v`ï¼ˆnpx å‘½ä»¤ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„ node_modules æ–‡ä»¶å¤¹ä¸‹æ‰¾ webpackï¼‰

```js
$ E:\project\leoXuLei\ReactDemoProject> npx webpack -v
4.46.0
```

### 2ã€å…¨å±€å®‰è£… webpack

```powershell
# å…¨å±€å®‰è£…webpack å’Œwebpack-cli
npm install webpack webpack-cli -g
```

> **ä¸æ¨èå…¨å±€å®‰è£… webpackï¼š**
> è¿™ä¼šå°†ä½ é¡¹ç›®ä¸­çš„ webpack é”å®šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ä¸åŒçš„ webpack ç‰ˆæœ¬çš„é¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å»ºå¤±è´¥ã€‚

### 3ã€é¡¹ç›®å†…å®‰è£… webpack

é¦–å…ˆæŠŠå…¨å±€å®‰è£…çš„ webpack å¸è½½æ‰ï¼Œ`npm uninstall webpack webpack-cli -g`

cmd ç®¡ç†å‘˜æƒé™ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•é‡Œé¢ï¼Œ
`npm install webpack webpack-cli --save-dev`(--save-dev ç­‰ä»·äº -D)

å®‰è£…å¥½äº†ä¹‹åå°±ä¼šå¤šå‡ºæ¥`node_modules`ç›®å½•ï¼ˆwebpack ä¾èµ–çš„åŒ…ï¼‰å’Œ`package-lock.json`ï¼Œä¹Ÿä¼šæ›´æ–°`package.json`ã€‚

è¿™ç§é¡¹ç›®å†…å®‰è£… webpack çš„æ–¹å¼ä½¿å¾—æˆ‘ä»¬å®ç°äº†åœ¨ä¸åŒé¡¹ç›®ä¸­ä½¿ç”¨ä¸åŒçš„ webpack ç‰ˆæœ¬

### 4ã€æ‰§è¡Œæ‰“åŒ…å‘½ä»¤

è¿˜è®°å¾—å®‰è£…`webpack`çš„æ—¶å€™ä¹Ÿè¦å®‰è£…è¿™ä¸ª`webpack-cli`å˜›ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è®©æˆ‘ä»¬èƒ½åœ¨å‘½ä»¤è¡Œé‡Œé¢æ­£ç¡®è¿è¡Œ webpack è¿™æ¡å‘½ä»¤ï¼Œå¦‚æœä¸å®‰è£…å°±æ— æ³•æ­£ç¡®åœ¨å‘½ä»¤è¡Œé‡Œè¿è¡Œ`webpack`æˆ–è€…`npx webpack`

æ‰“åŒ…çš„å‘½ä»¤ç›®å‰æœ‰è¿™å‡ ç§ï¼šæœ¬è´¨éƒ½æ˜¯è¿è¡Œ webpack è¿™æ¡å‘½ä»¤

```powerShell
npx webpack index.js     // index.jsä¸ºæŒ‡å®šæ‰“åŒ…çš„å…¥å£æ–‡ä»¶(è®©webpackå»ç¿»è¯‘index.js)
npx webpack          // æŒ‰ç…§é…ç½®æ–‡ä»¶webpack.config.jså»æ‰“åŒ…
npm run bundle ->webpack   // ç”¨npmScriptç®€åŒ–æˆ‘ä»¬çš„æ‰“åŒ…ä»£ç 

<#
  "scripts": {
    "bundle": "webpack"
  },
#>
```

# **åŸºæœ¬æ¦‚å¿µ**

## **æ¦‚å¿µ**

### ã€ä¸€ã€‘webpack æ˜¯ä»€ä¹ˆï¼šæ¨¡å—æ‰“åŒ…å·¥å…·

> æœ¬è´¨ä¸Šï¼Œwebpack æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾(dependency graph)ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundleã€‚

æ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œå¦‚ä¸‹ï¼Œåˆ†åˆ«æ˜¯å¼•å…¥ä¸‰ä¸ªæ¨¡å—ï¼Œwebpack èƒ½å¤ŸæŠŠä½ å¼•å…¥çš„è¿™äº›æ¨¡å—ï¼Œæ‰“åŒ…åˆ°ä¸€èµ·ï¼Œç”Ÿæˆä¸€ä¸ªæœ€ç»ˆçš„ js æ–‡ä»¶ã€‚æ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å·¥å…·ã€‚ï¼ˆimport è¡¨ç¤ºå¼•å…¥äº†ä¸€ä¸ªæ¨¡å—ï¼‰

```js
import Header from "./header.js";
import Sidebar from "./sidebar.js";
import Content from "./content.js";
```

é™¤äº† ES module æ¨¡å—å¼•å…¥æ–¹å¼ï¼Œè¿˜æœ‰åˆ«çš„æ¨¡å—å¼•å…¥æ–¹å¼ï¼Œå¦‚ Common JS æ¨¡å—å¼•å…¥è§„èŒƒï¼ŒCMDï¼ŒAMDã€‚Webpack ä¸€æ ·å¯ä»¥è¯†åˆ«ã€‚

### ã€äºŒã€‘entry å’Œ output

- entry
  > å…¥å£èµ·ç‚¹(entry point)ï¼šæŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ã€‚è¿›å…¥å…¥å£èµ·ç‚¹åï¼Œwebpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„ã€‚æ¯ä¸ªä¾èµ–é¡¹éšå³è¢«å¤„ç†ï¼Œæœ€åè¾“å‡ºåˆ°ç§°ä¹‹ä¸º bundles çš„æ–‡ä»¶ä¸­

å¯ä»¥é€šè¿‡åœ¨ webpack é…ç½®ä¸­é…ç½® entry å±æ€§ï¼Œæ¥æŒ‡å®šä¸€ä¸ªå…¥å£èµ·ç‚¹ï¼ˆæˆ–å¤šä¸ªå…¥å£èµ·ç‚¹ï¼‰ã€‚é»˜è®¤å€¼ä¸º ./srcã€‚

```js
module.exports = {
  entry: "./path/to/my/entry/file.js",
};
```

- output
  > output å±æ€§å‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundlesï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ï¼Œé»˜è®¤å€¼ä¸º ./distã€‚åŸºæœ¬ä¸Šï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºç»“æ„ï¼Œéƒ½ä¼šè¢«ç¼–è¯‘åˆ°ä½ æŒ‡å®šçš„è¾“å‡ºè·¯å¾„çš„æ–‡ä»¶å¤¹ä¸­ã€‚

ä½ å¯ä»¥é€šè¿‡åœ¨é…ç½®ä¸­æŒ‡å®šä¸€ä¸ª output å­—æ®µï¼Œæ¥é…ç½®è¿™äº›å¤„ç†è¿‡ç¨‹ï¼š

```js
const path = require("path");

module.exports = {
  entry: "./path/to/my/entry/file.js",
  output: {
    path: path.resolve(__dirname, "dist"),
    filename: "my-first-webpack.bundle.js",
  },
};
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ output.filename å’Œ output.path å±æ€§ï¼Œ==æ¥å‘Šè¯‰ webpack bundle çš„åç§°ï¼Œä»¥åŠæˆ‘ä»¬æƒ³è¦ bundle ç”Ÿæˆ(emit)åˆ°å“ªé‡Œ==ã€‚å¯èƒ½ä½ æƒ³è¦äº†è§£åœ¨ä»£ç æœ€ä¸Šé¢å¯¼å…¥çš„ path æ¨¡å—æ˜¯ä»€ä¹ˆï¼Œå®ƒæ˜¯ä¸€ä¸ª Node.js æ ¸å¿ƒæ¨¡å—ï¼Œç”¨äºæ“ä½œæ–‡ä»¶è·¯å¾„ã€‚

### ã€ä¸‰ã€‘loaderï¼šæ¨¡å—æ‰“åŒ…çš„æ–¹æ¡ˆ

> **ä½œç”¨ï¼š**
> ==loader è®© webpack èƒ½å¤Ÿå»å¤„ç†é‚£äº›é JavaScript æ–‡ä»¶ï¼ˆwebpack è‡ªèº«åªç†è§£ JavaScriptï¼‰ã€‚loader å¯ä»¥å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º webpack èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å—==ï¼Œç„¶åä½ å°±å¯ä»¥åˆ©ç”¨ webpack çš„æ‰“åŒ…èƒ½åŠ›ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ã€‚

> **é€šä¿—ç†è§£ä½œç”¨ï¼š**
> (webpack é»˜è®¤çŸ¥é“å¦‚ä½•æ‰“åŒ… js æ–‡ä»¶ï¼Œä½†æ˜¯å¯¹äºåˆ«çš„ç±»å‹æ–‡ä»¶ï¼Œå¦‚.jpg/.css/.png ç­‰ç­‰ï¼Œå°±ä¸çŸ¥é“æ€ä¹ˆæ‰“åŒ…äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾—åœ¨é…ç½®æ–‡ä»¶é‡Œé¢å‘Šè¯‰ webpack)

> **æœ¬è´¨ï¼š**
> æ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…çš„æ–¹æ¡ˆï¼Œå®Œæˆä¸åŒç±»å‹æ–‡ä»¶çš„æ‰“åŒ…

> **æ³¨æ„ï¼š**
> åœ¨ webpack é…ç½®ä¸­ï¼Œloader æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œæ˜¯ä»ä¸‹åˆ°ä¸Šï¼Œä»å³åˆ°å·¦ï¼Œï¼ˆå†™æ³•ä¹ŸæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼‰

æœ¬è´¨ä¸Šï¼Œwebpack loader å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶ï¼Œè½¬æ¢ä¸ºåº”ç”¨ç¨‹åºçš„ä¾èµ–å›¾ï¼ˆå’Œæœ€ç»ˆçš„ bundleï¼‰å¯ä»¥ç›´æ¥å¼•ç”¨çš„æ¨¡å—ã€‚

åœ¨æ›´é«˜å±‚é¢ï¼Œåœ¨ webpack çš„é…ç½®ä¸­ loader æœ‰ä¸¤ä¸ªç›®æ ‡ï¼š

- test å±æ€§ï¼Œç”¨äºæ ‡è¯†å‡ºåº”è¯¥è¢«å¯¹åº”çš„ loader è¿›è¡Œè½¬æ¢çš„æŸä¸ªæˆ–æŸäº›æ–‡ä»¶ã€‚
- use å±æ€§ï¼Œè¡¨ç¤ºè¿›è¡Œè½¬æ¢æ—¶ï¼Œåº”è¯¥ä½¿ç”¨å“ªä¸ª loaderã€‚

```js
const path = require("path");

const config = {
  output: {
    filename: "my-first-webpack.bundle.js",
  },
  module: {
    rules: [{ test: /\.txt$/, use: "raw-loader" }],
  },
};

module.exports = config;
```

> â€œå˜¿ï¼Œwebpack ç¼–è¯‘å™¨ï¼Œå½“ä½ ç¢°åˆ°ã€Œåœ¨ require()/import è¯­å¥ä¸­è¢«è§£æä¸º '.txt' çš„è·¯å¾„ã€æ—¶ï¼Œåœ¨ä½ å¯¹å®ƒæ‰“åŒ…ä¹‹å‰ï¼Œå…ˆä½¿ç”¨ raw-loader è½¬æ¢ä¸€ä¸‹ã€‚

#### æ–‡ä»¶

- file-loaderï¼šå°†æ–‡ä»¶å‘é€åˆ°è¾“å‡ºæ–‡ä»¶å¤¹ï¼Œå¹¶è¿”å›ï¼ˆç›¸å¯¹ï¼‰URL
- url-loaderï¼šåƒ file loader ä¸€æ ·å·¥ä½œï¼Œä½†å¦‚æœæ–‡ä»¶å°äºé™åˆ¶ï¼Œå¯ä»¥è¿”å› data URL

url-loaderÂ  åŠŸèƒ½ç±»ä¼¼äº Â `file-loader`ï¼Œä½†æ˜¯åœ¨æ–‡ä»¶å¤§å°ï¼ˆå•ä½ byteï¼‰ä½äºæŒ‡å®šçš„é™åˆ¶æ—¶ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ª DataURLã€‚ä¼šæŠŠå›¾ç‰‡è½¬åŒ–æˆä¸€ä¸ª base64 çš„å›¾ç‰‡ï¼Œç›´æ¥æ”¾åˆ° bundle.js é‡Œé¢ï¼Œè€Œä¸æ˜¯æŒ‰ç…§é…ç½®ç”Ÿæˆ image æ–‡ä»¶å¤¹

> **æœ€ä½³å®è·µï¼š**
> å¦‚æœå›¾ç‰‡éå¸¸å°ï¼Œç”¨ url-loader æ‰“åŒ…åˆ° js é‡Œé¢æ˜¯éå¸¸å¥½çš„é€‰æ‹©ï¼Œæ²¡æœ‰å¿…è¦è®© 12kb çš„å›¾ç‰‡å†å‘ä¸€æ¬¡ http è¯·æ±‚ï¼Œæµªè´¹æ—¶é—´ï¼Œå¦‚æœè¿™ä¸ªå›¾ç‰‡å¾ˆå¤§ï¼Œå°±åº”è¯¥ç”¨ file-loaderï¼Œå•ç‹¬è¯·æ±‚å›¾ç‰‡æ”¾åˆ° images æ–‡ä»¶å¤¹ä¸‹ã€‚

#### æ ·å¼

åœ¨ webpack é…ç½®ä¸­ï¼Œloader æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œæ˜¯ä»ä¸‹åˆ°ä¸Šï¼Œä»å³åˆ°å·¦ã€‚

|                  | ä½œç”¨                                                                                       |
| ---------------- | ------------------------------------------------------------------------------------------ |
| style-loader     | å°†æ¨¡å—çš„å¯¼å‡ºï¼ˆcss-loader è§£æçš„ç»“æœï¼‰ä½œä¸ºæ ·å¼æ·»åŠ åˆ° DOM ä¸­ï¼ˆé€šè¿‡ style æ ‡ç­¾ï¼‰              |
| css -loader      | è´Ÿè´£è§£æ CSS ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¤„ç† CSS ä¸­çš„ä¾èµ–ï¼Œä¾‹å¦‚ @import å’Œ url() ç­‰å¼•ç”¨å¤–éƒ¨æ–‡ä»¶çš„å£°æ˜ |
| sass-loader      | å°† sass/scss ä»£ç è½¬è¯‘æˆ css ä»£ç                                                            |
| postercss-loader | å®ç°è‡ªåŠ¨æ·»åŠ æ ·å¼å‚å•†å‰ç¼€åŠŸèƒ½                                                               |

#### è½¬æ¢ç¼–è¯‘

(Transpiling)

- babel-loaderï¼šåŠ è½½ ES2015+ ä»£ç ï¼Œç„¶åä½¿ç”¨ Babel è½¬è¯‘ä¸º ES5

### ã€å››ã€‘æ’ä»¶(plugins)ï¼šä½¿æ‰“åŒ…æ›´ä¾¿æ·

> **ä½œç”¨ï¼š**
> loader è¢«ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼Œè€Œæ’ä»¶åˆ™å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚æ’ä»¶çš„èŒƒå›´åŒ…æ‹¬ï¼Œä»æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©ï¼Œä¸€ç›´åˆ°é‡æ–°å®šä¹‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚æ’ä»¶æ¥å£åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å„ç§å„æ ·çš„ä»»åŠ¡ã€‚ï¼ˆ==å¯ä»¥å† webpack è¿è¡Œåˆ°æŸä¸ªæ—¶åˆ»çš„æ—¶å€™ï¼Œå¸®ä½ åšä¸€äº›äº‹æƒ…ï¼Œåƒæ˜¯ react ä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°==ï¼‰

æƒ³è¦ä½¿ç”¨ä¸€ä¸ªæ’ä»¶ï¼Œä½ åªéœ€è¦ require() å®ƒï¼Œç„¶åæŠŠå®ƒæ·»åŠ åˆ° plugins æ•°ç»„ä¸­ã€‚å¤šæ•°æ’ä»¶å¯ä»¥é€šè¿‡é€‰é¡¹(option)è‡ªå®šä¹‰ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­å› ä¸ºä¸åŒç›®çš„è€Œå¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ªæ’ä»¶ï¼Œè¿™æ—¶éœ€è¦é€šè¿‡ä½¿ç”¨ new æ“ä½œç¬¦æ¥åˆ›å»ºå®ƒçš„ä¸€ä¸ªå®ä¾‹ã€‚

> **åˆ†ç±»ï¼š**

- `clean-webpack-plugin`ï¼šåœ¨æ‰“åŒ…å‰è‡ªåŠ¨åˆ é™¤ dist æ–‡ä»¶å¤¹

- `html-Webpack-Plugin`: ä¼šåœ¨æ‰“åŒ…ç»“æŸåï¼Œæ ¹æ® HTML æ¨¡æ¿æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª html æ–‡ä»¶ï¼Œå¹¶æŠŠæ‰“åŒ…ç”Ÿæˆçš„ js è‡ªåŠ¨å¼•å…¥åˆ°è¿™ä¸ª html æ–‡ä»¶ä¸­

```js
var HtmlWebpackPlugin = require("html-webpack-plugin");
var path = require("path");

var webpackConfig = {
  entry: "index.js",
  output: {
    path: path.resolve(__dirname, "./dist"),
    filename: "index_bundle.js",
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: "./src/index.html",
    }),
  ],
};
```

- `webpack-bundle-analyzer`ï¼šwebpack æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–
  [å‚è€ƒé“¾æ¥](https://www.jianshu.com/p/eadd2fb68d48)
  [webpack-libs-optimizations ä¾èµ–åŒ…ä¼˜åŒ–](https://github.com/GoogleChromeLabs/webpack-libs-optimizations)
  `npm install --save-dev webpack-bundle-analyzer`
  ```js
  const BundleAnalyzerPlugin =
    require("webpack-bundle-analyzer").BundleAnalyzerPlugin;
  module.exports = {
    plugins: [new BundleAnalyzerPlugin()],
  };
  ```
  åœ¨ é¡¹ç›®çš„ `package.json` æ–‡ä»¶ä¸­æ³¨å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œä»¥æ–¹ä¾¿è¿è¡Œå¥¹(npm run analyz)ï¼Œé»˜è®¤ä¼šæ‰“å¼€http://127.0.0.1:8888ä½œä¸ºå±•ç¤ºã€‚
  `'analyz': 'NODE_ENV=production npm_config_report=true npm run build'`
  è¿™æ ·è¿è¡Œ npm run build åæµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ 127.0.0.1:8888 å±•ç¤ºå¦‚ä¸‹é¡µé¢ï¼š

### ã€äº”ã€‘æ¨¡å¼

é€šè¿‡é€‰æ‹© development æˆ– production ä¹‹ä¸­çš„ä¸€ä¸ªï¼Œæ¥è®¾ç½® mode å‚æ•°ï¼Œä½ å¯ä»¥å¯ç”¨ç›¸åº”æ¨¡å¼ä¸‹çš„ webpack å†…ç½®çš„ä¼˜åŒ–

- é»˜è®¤ç”Ÿäº§æ¨¡å¼ï¼Œä»£ç å‹ç¼©ï¼Œå¼€å‘æ¨¡å¼ä»£ç ä¸å‹ç¼©ã€‚

```js
module.exports = {
  mode: "production",
};
```

å®ä¾‹å¯¹æ¯”å¯è§ `å®æˆ˜æµç¨‹ - å®‰è£…é…ç½® webpack`

### ã€å…­ã€‘Babel

å› ä¸º chrome å’Œæœç‹—æµè§ˆå™¨æ¯”è¾ƒä¸æ—¶ä¿±è¿›ï¼ŒES6 è§„èŒƒä¸­çš„éƒ½ç”¨äº†ä¸€äº›å®ç°ï¼Œæ‰€ä»¥ ES6 ä»£ç èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«æ‰§è¡Œã€‚ä½†æ˜¯å¦‚æœåœ¨ä¸€äº›ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ï¼ˆå¦‚ IEï¼‰æ‰“å¼€é¡µé¢ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºä¸æ”¯æŒ ES6ã€‚æ‰€ä»¥éœ€è¦å€ŸåŠ© babelï¼Œå®ç°åœ¨ webpack æ‰“åŒ…çš„æ—¶å€™æŠŠ ES6 ä»£ç è½¬æˆ ES5 ä»£ç ã€‚

- **ã€1ã€‘äº†è§£ Babel åŠç”Ÿæ€**

  > **è½¬è¯‘**
  > ç°ä»£ Javascript ä¸»è¦æ˜¯ç”¨ ES6 ç¼–å†™çš„ã€‚ä½†å¹¶éæ¯ä¸ªæµè§ˆå™¨éƒ½çŸ¥é“å¦‚ä½•å¤„ç† ES6ã€‚ æˆ‘ä»¬éœ€è¦æŸç§è½¬æ¢ï¼Œè¿™ä¸ªè½¬æ¢æ­¥éª¤ç§°ä¸º transpiling(è½¬è¯‘)ã€‚transpiling(è½¬è¯‘) æ˜¯æŒ‡å°† ES6 è¯­æ³•ï¼Œè½¬è¯‘ä¸ºæ—§æµè§ˆå™¨å¯ä»¥ç†è§£çš„è¯­æ³•ã€‚

  > Ecmascript çš„ä»£ç ä¸€ç›´åœ¨æ›´æ–° ä½†æ˜¯æµè§ˆå™¨çš„å…¼å®¹å´æ²¡æœ‰æ ¹ä¸Šï¼Œbabel å°±å®ç°äº†åˆ©ç”¨æœåŠ¡ç«¯ node çš„ å¯¼å…¥å¯¼å‡ºç‰¹æ€§ï¼Œ==å®ç°äº† js ä»£ç çš„æ¸è¿›å¢å¼ºã€å¹³ç¨³é€€åŒ–ã€‚è®©æˆ‘ä»¬å¯ä»¥éšæ„ä½¿ç”¨æ–°è¯­æ³•è€Œä¸ç”¨è€ƒè™‘æµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜==

è¦å¼€å§‹ä½¿ç”¨ loader ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€å †ä¾èµ–é¡¹ï¼Œä»¥ä¸‹å·² Babel7 ä¸ºä¸»ï¼Œ

- ==babel-loader==: åŠ è½½ ES2015+ ä»£ç ï¼Œç„¶åä½¿ç”¨ Babel è½¬è¯‘ä¸º ES5
- ==@babel/core==ï¼šbabel çš„æ ¸å¿ƒåº“
- ==@babel/preset-env==ï¼šåŒ…å« ES6 åŠä»¥ä¸Šç‰ˆæœ¬çš„è¯­æ³•è½¬åŒ–ä¸º ES5 è¯­æ³•çš„è§„åˆ™ã€‚
  (**ä¸ºä»€ä¹ˆå®‰è£…**ï¼šä½¿ç”¨ babel-loader å¤„ç† js æ–‡ä»¶çš„æ—¶å€™ï¼Œbabel-loader å®é™…ä¸Šåªæ˜¯ webpack ä¸ babel ä¹‹é—´é€šä¿¡çš„ä¸€ä¸ªæ¡¥æ¢ï¼Œåªæ˜¯åšäº†æ‰“é€šï¼Œä½†å®é™…ä¸Š babel-loader å¹¶ä¸ä¼šæŠŠä»£ç é‡Œ ES6 è¯­æ³•ç¿»è¯‘æˆ ES5 è¯­æ³•ï¼Œè¦æƒ³å®ç°ä»£ç  ES6 è¯­æ³•ç¿»è¯‘æˆ ES5 è¯­æ³•ï¼Œè¿˜å¾—å€ŸåŠ©å…¶ä»–æ¨¡å—ï¼Œ`@babel/preset-env` å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ¨¡å—)
- ==@babel/polyfill==: ES6 å†…ç½®æ–¹æ³•å’Œå‡½æ•°è½¬åŒ–å«ç‰‡(@babel/preset-env åªç¿»è¯‘äº†éƒ¨åˆ†ï¼Œæ²¡ç¿»è¯‘å®Œå…¨)
- ==@babel/plugin-transform-runtime==: é¿å… polyfill æ±¡æŸ“å…¨å±€å˜é‡ï¼Œå‡å°æ‰“åŒ…ä½“ç§¯

- ==@babel/preset-react==ï¼šå¸®åŠ©æˆ‘ä»¬è§£æ React é‡Œé¢çš„ jsx è¯­æ³•ï¼Œä½¿ç”¨ä¹‹åå°±å¯ä»¥åœ¨ä»£ç é‡Œé¢ç¼–å†™ React çš„è¯­æ³•ç»“æ„äº†
- ==@babel/cli== ä»ç»ˆç«¯è¿è¡Œ Babel

> å¦‚æœæ˜¯ç”¨ babel7 æ¥è½¬è¯‘ï¼Œéœ€è¦å®‰è£… @babel/coreã€@babel/preset-env å’Œ @babel/plugin-transform-runtimeï¼Œè€Œä¸æ˜¯ babel-coreã€babel-preset-env å’Œ babel-plugin-transform-runtimeï¼Œå®ƒä»¬æ˜¯ç”¨äº babel6 çš„

> ä½¿ç”¨ @babel/plugin-transform-runtime çš„åŸå› ï¼šBabel ä½¿ç”¨éå¸¸å°çš„åŠ©æ‰‹æ¥å®Œæˆå¸¸è§åŠŸèƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°†æ·»åŠ åˆ°éœ€è¦å®ƒçš„æ¯ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™ç§é‡å¤æœ‰æ—¶æ˜¯ä¸å¿…è¦çš„ï¼Œå°¤å…¶æ˜¯å½“ä½ çš„åº”ç”¨ç¨‹åºåˆ†å¸ƒåœ¨å¤šä¸ªæ–‡ä»¶ä¸Šçš„æ—¶å€™ã€‚ transform-runtime å¯ä»¥é‡å¤ä½¿ç”¨ Babel æ³¨å…¥çš„ç¨‹åºä»£ç æ¥èŠ‚çœä»£ç ï¼Œå‡å°ä½“ç§¯ã€‚

> ä½¿ç”¨ @babel/polyfill çš„åŸå› ï¼šBabel é»˜è®¤åªè½¬æ¢æ–°çš„ JavaScript å¥æ³•ï¼ˆsyntaxï¼‰ï¼Œè€Œä¸è½¬æ¢æ–°çš„ APIï¼Œæ¯”å¦‚ Iteratorã€Generatorã€Setã€Mapsã€Proxyã€Reflectã€Symbolã€Promise ç­‰å…¨å±€å¯¹è±¡ï¼Œä»¥åŠä¸€äº›å®šä¹‰åœ¨å…¨å±€å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼ˆæ¯”å¦‚ Object.assignï¼‰éƒ½ä¸ä¼šè½¬ç ã€‚å¿…é¡»ä½¿ç”¨ @babel/polyfillï¼Œä¸ºå½“å‰ç¯å¢ƒæä¾›ä¸€ä¸ªå«ç‰‡(==å³åªç¿»è¯‘äº†éƒ¨åˆ†ï¼Œæ²¡ç¿»è¯‘å®Œå…¨ï¼Œå¦‚ä¸Šé¢çš„ promise ç­‰)ã€‚ æ‰€è°“å«ç‰‡ä¹Ÿå°±æ˜¯å«å¹³ä¸åŒæµè§ˆå™¨æˆ–è€…ä¸åŒç¯å¢ƒä¸‹çš„å·®å¼‚==

### ã€ä¸ƒã€‘browserslist

[webpack4.0 æ ¸å¿ƒæ¦‚å¿µï¼ˆäº”ï¼‰ browserslist](https://blog.csdn.net/qq_37899792/article/details/108747116)

### ã€å…«ã€‘å®ç° HMRï¼šæ¨¡å—çƒ­æ›´æ–°

Hot Module Replacement æ¨¡å—çƒ­æ›´æ–°

> **ä»€ä¹ˆæ˜¯æ¨¡å—çƒ­æ›´æ–°ï¼š**
> æ¨¡å—çƒ­æ›¿æ¢æ˜¯æŒ‡åœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ›¿æ¢ã€æ·»åŠ ã€åˆ é™¤æ¨¡å—ï¼Œè€Œæ— éœ€é‡æ–°åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚

> **HMR é€šè¿‡å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼Œæ¥æé«˜å¼€å‘çš„é€Ÿåº¦**

- ä¸é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ï¼Œè¿™æ ·å¯ä»¥ä¿ç•™æŸäº›åº”ç”¨ç¨‹åºçš„çŠ¶æ€ä¸ä¸¢å¤±ï¼›
- åªéœ€æ›´æ–°éœ€è¦å˜åŒ–çš„å†…å®¹ï¼ŒèŠ‚çœå¼€å‘æ—¶é—´
- ä¿®æ”¹äº† cssã€js æºä»£ç ï¼Œä¼šç«‹å³åœ¨æµè§ˆå™¨æ›´æ–°ï¼Œç›¸å½“äºç›´æ¥åœ¨æµè§ˆå™¨çš„ devtools ä¸­ç›´æ¥ä¿®æ”¹æ ·å¼ã€‚

> **å¦‚ä½•é…ç½®**

```js
target: "web", // webpack5 å¿…é¡»åŠ ä¸ªtargetå±æ€§ å¦åˆ™æ— æ³•ä¿®æ”¹ä»£ç åè‡ªåŠ¨åˆ·æ–°æ•´ä¸ªé¡µé¢
// å½“æ—¶ä¸ºäº†è§£å†³æ•´ä¸ªé—®é¢˜ï¼Œæäº†3Hä¹Ÿæ²¡è§£å†³ï¼Œæœ€ç»ˆè§£å†³æ˜¯é‡æ–°æ•´ç†äº†é—®é¢˜æè¿°ï¼Œå°±æœåˆ°äº†ï¼šwebpack5.0 ä½¿ç”¨webpack-dev-serveræ—¶ï¼Œæ— æ³•è‡ªåŠ¨åˆ·æ–°é¡µé¢ã€‚
```

é…ç½®åä¿®æ”¹ä»£ç å¯ä»¥çœ‹åˆ°ç•Œé¢è‡ªåŠ¨åˆ·æ–°

```js
[WDS] Live Reloading enabled.

// webpack://react-demo/node_modules/webpack-dev-server/client/index.js
```

> **å¦‚ä½•ä½¿ç”¨ HMRï¼Ÿ**
> ä¸‰æ­¥éª¤

- 1. é»˜è®¤æƒ…å†µä¸‹ï¼Œwebpack-dev-server å·²ç»æ”¯æŒ HMRï¼Œåªéœ€è¦å¼€å¯å³å¯ã€‚éœ€è¦åŠ ä¸ª `hot: true`
- 2. ç„¶åå¼•å…¥ä¸€ä¸ª`new webpack.HotModuleReplacementPlugin()` webpack è‡ªå¸¦æ’ä»¶
- 3. æœ€åè¿˜å¾—åœ¨éœ€è¦è®¾ç½®çƒ­æ›´æ–°çš„ JS æ¨¡å—å¤„æ‰‹åŠ¨å®šä¹‰ä½¿ç”¨ HMR çš„æ¨¡å—ã€‚å¦‚æœæ˜¯ CSS çš„ HMR åˆ™ä¸éœ€è¦æ‰‹åŠ¨å®šä¹‰é…ç½®ï¼Œå› ä¸º css çš„ loader å·²ç»åšäº†ï¼Œè‡ªæ­å»ºé¡¹ç›® JS çš„ HMR å°±å¾—å¦‚ä¸‹å®šä¹‰ï¼Œä½†æ˜¯ React è„šæ‰‹æ¶é¡¹ç›®åˆ™ä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨åšï¼Œè„šæ‰‹æ¶ç­‰åº•å±‚ä¼šæŠŠ HMR çš„ä»£ç åšå¥½ã€‚

```js
if (module.hot) {
  module.hot.accept("./number", () => {
    document.body.removeChild(document.getElementById("number"));
    number(); //
  });
}
```

- å¦å¤–ä¸€ç§é…ç½®æ–¹æ³•(è§å‚è€ƒé“¾æ¥)ï¼š
  > å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨ä¸Šé¢çš„é…ç½®ä¸­å¹¶æ²¡æœ‰é…ç½® HotModuleReplacementPluginï¼ŒåŸå› åœ¨äºå½“æˆ‘ä»¬è®¾ç½® devServer.hot ä¸º true åï¼Œå¹¶ä¸”åœ¨ package.json æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹çš„ script è„šæœ¬ï¼š
  > "start": "webpack-dev-server --hot --open"
  > **æ·»åŠ  â€”hot é…ç½®é¡¹åï¼ŒdevServer ä¼šå‘Šè¯‰ webpack è‡ªåŠ¨å¼•å…¥ HotModuleReplacementPlugin æ’ä»¶**ï¼Œè€Œä¸ç”¨æˆ‘ä»¬å†æ‰‹åŠ¨å¼•å…¥äº†ã€‚

> **HMR æ•ˆæœï¼š**

CSS çš„ HMR å®ç°æ•ˆæœå¦‚ä¸‹
![](./imgs/webpack-dev-server-css-HMR.png)

> **å…¶å®ƒï¼š**

HMR å¼€å¤´çš„ä¿¡æ¯æç¤ºç”± webpack/hot/dev-server æ¨¡å—äº§ç”Ÿ

æ€»ç»“ï¼šjs é‡Œå®ç°ä»£ç  HMRï¼Œç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦ç›‘å¬å¯¹åº”çš„æ¨¡å—æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå†å»é‡æ–°æ‰§è¡Œè¿™ä¸ªæ¨¡å—ï¼Œ

é—®é¢˜ï¼šä¸ºå•¥ cssHMR çš„æ—¶å€™ä¸éœ€è¦å»ç›‘å¬ï¼Œæ‰‹å†™ä¸€äº›ä»£ç å‘¢ï¼Œå› ä¸º css-loader é‡Œé¢å·²ç»å¸®ä½ åšäº†è¿™ä¸ªäº‹æƒ…ï¼Œæ‰€ä»¥è‡ªå·±å°±ä¸ç”¨å†å†™ä¸€éäº†ã€‚

**å‚è€ƒé“¾æ¥ï¼š**

- [Webpack DevServer å’Œ HMR åŸç† - å‰ç«¯ LeBron çš„æ–‡ç«  - çŸ¥ä¹
  ](https://zhuanlan.zhihu.com/p/375264720)

- [Webpack HMR åŸç†è§£æ - å†‰å››å¤•çš„æ–‡ç«  - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/30669007)
- [å¯ç”¨ Webpack æœåŠ¡ä½¿ç”¨çƒ­æ›´æ–°](http://ljylk.cn/?p=713)

### ã€ä¹ã€‘Tree Shaking

tree shaking æ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œé€šå¸¸ç”¨äºæè¿°ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç (dead-code)

ä½ å¯ä»¥å°†åº”ç”¨ç¨‹åºï¼ˆå¯¼å‡ºæ¨¡å—çš„åœ°æ–¹ï¼‰æƒ³è±¡æˆä¸€æ£µæ ‘ã€‚ç»¿è‰²è¡¨ç¤ºå®é™…ç”¨åˆ°çš„æºç å’Œ libraryï¼Œæ˜¯æ ‘ä¸Šæ´»çš„æ ‘å¶ã€‚ç°è‰²è¡¨ç¤ºæ— ç”¨çš„ä»£ç ï¼Œæ˜¯ç§‹å¤©æ ‘ä¸Šæ¯èçš„æ ‘å¶ã€‚ä¸ºäº†é™¤å»æ­»å»çš„æ ‘å¶ï¼Œä½ å¿…é¡»æ‘‡åŠ¨è¿™æ£µæ ‘ï¼Œä½¿å®ƒä»¬è½ä¸‹ã€‚

treeShakeing åªæ”¯æŒ ES module æ¨¡å—å¼•å…¥æ–¹å¼ã€‚

éœ€è¦é…ç½®ï¼Œå¦‚ä¸‹ï¼š
Webpack.config.js é…ç½®å¦‚ä¸‹

```js
// webpack.config.js
optimization:Â {
  usedExports:Â true
},


// package.json
{
...
"sideEffects":Â false,
Â Â //Â "sideEffects":Â ["@babel/polly-fill"],
  //Â "sideEffects":Â [Â "*.css"Â ]
...
}
```

### ã€åã€‘code split ä»£ç åˆ†å‰²

ä»£ç åˆ†ç¦»æ˜¯ webpack ä¸­æœ€å¼•äººæ³¨ç›®çš„ç‰¹æ€§ä¹‹ä¸€ã€‚æ­¤ç‰¹æ€§èƒ½å¤ŸæŠŠä»£ç åˆ†ç¦»åˆ°ä¸åŒçš„ bundle ä¸­ï¼Œç„¶åå¯ä»¥æŒ‰éœ€åŠ è½½æˆ–å¹¶è¡ŒåŠ è½½è¿™äº›æ–‡ä»¶ã€‚ä»£ç åˆ†ç¦»å¯ä»¥ç”¨äºè·å–æ›´å°çš„ bundleï¼Œä»¥åŠæ§åˆ¶èµ„æºåŠ è½½ä¼˜å…ˆçº§ï¼Œå¦‚æœä½¿ç”¨åˆç†ï¼Œä¼šæå¤§å½±å“åŠ è½½æ—¶é—´ã€‚
æœ‰ä¸‰ç§å¸¸ç”¨çš„ä»£ç åˆ†ç¦»æ–¹æ³•ï¼š

- å…¥å£èµ·ç‚¹ï¼šä½¿ç”¨ Â entryÂ  é…ç½®æ‰‹åŠ¨åœ°åˆ†ç¦»ä»£ç ã€‚
- é˜²æ­¢é‡å¤ï¼šä½¿ç”¨ Â CommonsChunkPluginÂ  å»é‡å’Œåˆ†ç¦» chunkã€‚
- åŠ¨æ€å¯¼å…¥ï¼šé€šè¿‡æ¨¡å—çš„å†…è”å‡½æ•°è°ƒç”¨æ¥åˆ†ç¦»ä»£ç ã€‚

æ²¡æœ‰ code splittingï¼Œä»£ç æ²¡æœ‰é—®é¢˜ï¼›ä½†æ˜¯æœ‰äº†åˆç†çš„ä»£ç åˆ†å‰²ä¹‹åï¼Œé€šè¿‡å¯¹ä»£ç è¿›è¡Œæ‹†åˆ†ï¼Œå°±èƒ½å‡å°‘è¯·æ±‚çš„å¤§å°ã€æ¬¡æ•°ï¼Œæå‡äº†æ€§èƒ½ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½ä¸€äº›ï¼Œ

### ã€åä¸€ã€‘æ‡’åŠ è½½

æ‡’åŠ è½½å…¶å®å‰ä¸¤èŠ‚ä»£ç åˆ†å‰²å°±å·²ç»æ¶‰åŠåˆ°äº†ï¼Œåªæ˜¯æ²¡æœ‰æç‚¼æ€»ç»“å‡ºæ¥ï¼šé€šè¿‡ import æ¥å¼‚æ­¥åŠ è½½ä¸€ä¸ªæ¨¡å— ç”±æŸä¸ªäº‹ä»¶è§¦å‘ï¼Œè§¦å‘ååŠ è½½ç›¸åº”æ¨¡å—ä»£ç ã€‚æ¡†æ¶ä»£ç ä¸­æ ¹æ®ä¸åŒè·¯ç”±æ¥åŠ è½½ç›¸åº”æ¨¡å—ä»£ç ï¼ˆå¦‚é¦–é¡µã€åˆ—è¡¨é¡µã€è¯¦æƒ…é¡µï¼‰ã€‚

å®šä¹‰
å®šä¹‰ï¼šæ‡’åŠ è½½æˆ–è€…æŒ‰éœ€åŠ è½½ï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„ä¼˜åŒ–ç½‘é¡µæˆ–åº”ç”¨çš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼å®é™…ä¸Šæ˜¯å…ˆæŠŠä½ çš„ä»£ç åœ¨ä¸€äº›é€»è¾‘æ–­ç‚¹å¤„åˆ†ç¦»å¼€ï¼Œç„¶ååœ¨ä¸€äº›ä»£ç å—ä¸­å®ŒæˆæŸäº›æ“ä½œåï¼Œç«‹å³å¼•ç”¨æˆ–å³å°†å¼•ç”¨å¦å¤–ä¸€äº›æ–°çš„ä»£ç å—ã€‚è¿™æ ·åŠ å¿«äº†åº”ç”¨çš„åˆå§‹åŠ è½½é€Ÿåº¦ï¼Œå‡è½»äº†å®ƒçš„æ€»ä½“ä½“ç§¯ï¼Œå› ä¸ºæŸäº›ä»£ç å—å¯èƒ½æ°¸è¿œä¸ä¼šè¢«åŠ è½½ã€‚

# **æŒ‡å—**

## ã€ä¸€ã€‘å¼€å‘

### ä½¿ç”¨ source map

> **èƒŒæ™¯ï¼š**
> å½“ webpack æ‰“åŒ…æºä»£ç æ—¶ï¼Œå¯èƒ½ä¼šå¾ˆéš¾è¿½è¸ªåˆ°é”™è¯¯å’Œè­¦å‘Šåœ¨æºä»£ç ä¸­çš„åŸå§‹ä½ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†ä¸‰ä¸ªæºæ–‡ä»¶ï¼ˆa.js, b.js å’Œ c.jsï¼‰æ‰“åŒ…åˆ°ä¸€ä¸ª bundleï¼ˆbundle.jsï¼‰ä¸­ï¼Œè€Œå…¶ä¸­ä¸€ä¸ªæºæ–‡ä»¶åŒ…å«ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆå †æ ˆè·Ÿè¸ªå°±ä¼šç®€å•åœ°æŒ‡å‘åˆ° bundle.jsã€‚è¿™å¹¶é€šå¸¸æ²¡æœ‰å¤ªå¤šå¸®åŠ©ï¼Œå› ä¸ºä½ å¯èƒ½éœ€è¦å‡†ç¡®åœ°çŸ¥é“é”™è¯¯æ¥è‡ªäºå“ªä¸ªæºæ–‡ä»¶ã€‚æ‰€ä»¥éœ€è¦ä½¿ç”¨ sourcemapï¼Œæ¥åšä¸€ä¸ªæºä»£ç å’Œæ‰“åŒ…ç”Ÿæˆä»£ç ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚
> **ä½œç”¨ï¼š**
> ==ä¸ºäº†æ›´å®¹æ˜“åœ°è¿½è¸ªé”™è¯¯å’Œè­¦å‘Šï¼ŒJavaScript æä¾›äº† source map åŠŸèƒ½ï¼Œå°†ç¼–è¯‘åçš„ä»£ç æ˜ å°„å›åŸå§‹æºä»£ç ï¼ˆæ¥åšä¸€ä¸ªæºä»£ç å’Œæ‰“åŒ…ç”Ÿæˆä»£ç ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ï¼‰==ã€‚å¦‚æœä¸€ä¸ªé”™è¯¯æ¥è‡ªäº b.jsï¼Œsource map å°±ä¼šæ˜ç¡®çš„å‘Šè¯‰ä½ ã€‚

> **æœ€ä½³å®è·µï¼š**

`devtool` æ­¤é€‰é¡¹æ§åˆ¶æ˜¯å¦ç”Ÿæˆï¼Œä»¥åŠå¦‚ä½•ç”Ÿæˆ source mapã€‚
é€‰æ‹©ä¸€ç§ source map æ ¼å¼æ¥å¢å¼ºè°ƒè¯•è¿‡ç¨‹ã€‚ä¸åŒçš„å€¼ä¼šæ˜æ˜¾å½±å“åˆ°æ„å»º(build)å’Œé‡æ–°æ„å»º(rebuild)çš„é€Ÿåº¦ã€‚
`// devtool: 'cheap-eval-source-map'`, å¼€å‘æ¨¡å¼ä¸‹è‡ªåŠ¨ä¼šé…ç½®

```js
devtool: 'cheap-module-eval-source-map' // developmentå¼€å‘ï¼š
devtoolï¼š'cheap-module-source-map' // productionç”Ÿäº§ï¼š
```

> **å®ä¾‹ï¼š**

```js
// ./src/test.js
consolse.log("æµ‹è¯•ç®­å¤´å‡½æ•°");
```

ä¸‹å›¾æ˜¯æœªå¼€å¯ devtool source-map æ—¶çš„æŠ¥é”™
![](./imgs/devtool-sourcemap-1.png)

ä¸‹å›¾æ˜¯å¼€å¯ devtool source-map æ—¶çš„æŠ¥é”™
`devtool: "inline-source-map"`
![](./imgs/devtool-sourcemap-2.png)

### é€‰æ‹©ä¸€ä¸ªå¼€å‘å·¥å…·: webpack-dev-server

> **èƒŒæ™¯ï¼š**
> æ¯æ¬¡ä¿®æ”¹ src ä¸‹é¢æºä»£ç ä¹‹åï¼Œè¦ä¿å­˜æ‰‹åŠ¨è¾“å…¥`npm run bundle`æ‰“åŒ…ï¼Œç„¶åå†æ‰‹åŠ¨æ‰“å¼€æ‰“åŒ…ç”Ÿæˆçš„ dist æ–‡ä»¶å¤¹ä¸‹çš„ index.htmlï¼Œ è¿™æ ·å¤ªéº»çƒ¦äº†ï¼

> æ‰€ä»¥å¸Œæœ›ä¿®æ”¹ src ç›®å½•ä¸‹çš„æºä»£ç ä¿å­˜ä¹‹åï¼Œä¼šè‡ªåŠ¨é‡æ–°æ‰“åŒ…ï¼Œè¿™æ ·å†å»é¡µé¢ä¸Šçœ‹æ•ˆæœå°±ç®€å•å¤šäº†ï¼Œå°±ä¸ç”¨æ¯æ¬¡å†æ‰‹åŠ¨è¾“å…¥`npm run bundle`äº†

webpack ä¸­æœ‰å‡ ä¸ªä¸åŒçš„é€‰é¡¹ï¼Œå¯ä»¥å¸®åŠ©ä½ åœ¨ä»£ç å‘ç”Ÿå˜åŒ–åè‡ªåŠ¨ç¼–è¯‘ä»£ç ï¼ˆä¿®æ”¹æºç è‡ªåŠ¨æ‰“åŒ…åŠŸèƒ½ï¼‰ï¼š

- webpack's Watch Mode
- webpack-dev-server
- webpack-dev-middleware

å¤šæ•°åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ webpack-dev-server

> **ä½¿ç”¨ webpackDevServer**

**å¥½å¤„**ï¼š

- å¸Œæœ›è¾“å…¥`npm run start`ä¹‹åèƒ½è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
- èƒ½å¤Ÿæ¨¡æ‹ŸæœåŠ¡å™¨ä¸Šçš„ä¸€äº›ç‰¹æ€§ï¼ˆæœ¬åœ°å¼€å¯ä¸€ä¸ªæœåŠ¡å™¨ï¼‰
  ä¹‹å‰æ‰‹åŠ¨æ‰“å¼€ dist ä¸‹çš„`index.html`æ–‡ä»¶ï¼Œæ˜¯é€šè¿‡`file/::`æ–‡ä»¶çš„å½¢å¼æ‰“å¼€ï¼Œè¿™ç§æ–¹å¼å°±æ²¡æ³•åœ¨é¡µé¢ä¸Šå‘èµ· ajax è¯·æ±‚ï¼Œæ‰€ä»¥è¦æƒ³å‘ ajax è¯·æ±‚ï¼Œå¿…é¡»å¾—åœ¨æœåŠ¡å™¨ä¸Šä»¥ http åè®®æ‰“å¼€ã€‚
- åé¢ä¿®æ”¹æºç ä¹Ÿèƒ½è‡ªåŠ¨ä»æ–°æ‰“åŒ…ä¸”èƒ½è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ä¸­æ‰“å¼€çš„é¡µé¢ã€‚

**å®‰è£…**ï¼š `npm install webpack-dev-server -D`
**é…ç½®**ï¼š

```js
"scripts": {
  "start": "webpack-dev-server --open" // æ·»åŠ ä¸€ä¸ª script è„šæœ¬ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œå¼€å‘æœåŠ¡å™¨(dev server)
},
```

```js




devServer: {
  contentBase: path.join(__dirname, "./dist"), // å‘Šè¯‰æœåŠ¡å™¨åœ¨å“ªé‡ŒæŸ¥æ‰¾æ–‡ä»¶
  port: 8080, // ç«¯å£å·
  open: "chrome", // è‡ªåŠ¨å¯æœåŠ¡å™¨
  // hot: true, // å¯ç”¨ webpack çš„æ¨¡å—çƒ­æ›¿æ¢ç‰¹æ€§
  // hotOnly: true  æ³¨é‡Šä¹‹å æŠ¥é”™ä»£ç åé¡µé¢è‡ªåŠ¨åˆ·æ–°
  // overlay: true, // ä»£ç å‡ºé”™å¼¹å‡ºæµ®åŠ¨å±‚
},
// ä»¥ä¸Šé…ç½®å‘ŠçŸ¥ webpack-dev-serverï¼Œåœ¨ localhost:8080 ä¸‹å»ºç«‹æœåŠ¡ï¼Œå°† dist ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä½œä¸ºå¯è®¿é—®æ–‡ä»¶ã€‚

```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ npm startï¼Œå°±ä¼šçœ‹åˆ°æµè§ˆå™¨è‡ªåŠ¨åŠ è½½é¡µé¢ã€‚å¦‚æœç°åœ¨ä¿®æ”¹å’Œä¿å­˜ä»»æ„æºæ–‡ä»¶ï¼Œweb æœåŠ¡å™¨å°±ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½ç¼–è¯‘åçš„ä»£ç (å³ ==å®æ—¶é‡æ–°åŠ è½½(live reloading)==ã€‚è¯•ä¸€ä¸‹ï¼

- é»˜è®¤çš„ï¼Œwebpack-dev-server çš„ hot å€¼ä¸º falseï¼Œè¿™æ—¶ï¼Œwebpack-dev-server ä¼šåœ¨æ–‡ä»¶ä¿®æ”¹ååˆ·æ–°é¡µé¢ï¼Œè¿™æ˜¯å†·æ›´æ–°ã€‚

```js
// é…ç½®å¥½ä¿®æ”¹æºç é¡µé¢è‡ªåŠ¨æ•´ä½“åˆ·æ–°åconsoleå¦‚ä¸‹
[HMR] Waiting for update signal from WDS...
index.js:48 [WDS] Hot Module Replacement enabled.
index.js:52 [WDS] Live Reloading enabled.
```

**å…¶å®ƒ**ï¼š
Proxy:é…ç½®æ˜¯å¹²å˜›çš„
æ˜¯å¸®æˆ‘ä»¬åšè·¨åŸŸçš„æ¥å£æ¨¡æ‹Ÿæ—¶å€™è¦ç”¨çš„æ¥å£ä»£ç†ï¼Œä¸ºä»€ä¹ˆåœ¨ vue å’Œ React ä¸­å¯ä»¥ä½¿ç”¨æ¥å£ä»£ç†å‘¢ï¼Œæ˜¯å› ä¸º vue å’Œ React è„šæ‰‹æ¶çš„åº•å±‚éƒ½ä½¿ç”¨äº† `webpack-dev-server`

# **æ’ä»¶**

## CopyWebpackPlugin

> **ä½œç”¨**
> å°†å•ä¸ªæ–‡ä»¶æˆ–æ•´ä¸ªç›®å½•å¤åˆ¶åˆ°æ„å»ºç›®å½•

```js
const CopyWebpackPlugin = require("copy-webpack-plugin"); // é™æ€èµ„æºæ‹·è´ï¼šå°†å•ä¸ªæ–‡ä»¶æˆ–æ•´ä¸ªç›®å½•å¤åˆ¶åˆ°æ„å»ºç›®å½•

module.exports = {
  plugins: [
    new CopyWebpackPlugin({
      patterns: [
        {
          from: "src/static/*.js",
          to: `${path.resolve(__dirname, "dist", "js")}/[name][ext]`, // è¾“å‡ºåˆ° dist/js/[name][ext]
        },
        // è¿˜å¯ä»¥ç»§ç»­é…ç½®å…¶å®ƒè¦æ‹·è´çš„æ–‡ä»¶
      ],
    }),
  ],
};
```

# **å®æˆ˜æµç¨‹**

## ã€ä¸€ã€‘æ–°å»ºé¡¹ç›®

````powershell
1. mkdir xxx  # æ–°å»ºæ–‡ä»¶å¤¹
2. cd xxx  # è¿›å…¥æ–‡ä»¶å¤¹
3. npm init -y   # åˆå§‹åŒ–é¡¹ç›®ï¼ˆåŠ ä¸Š-yçš„è¯å°±ä¸ä¼šè¯¢é—®å¡«ä¿¡æ¯ï¼Œç›´æ¥é»˜è®¤ç”Ÿæˆï¼‰

4. # ä¿®æ”¹package.json
    - æ–°å¢ "private": true
    - æ–°å¢ "author": "xulei"

5. # æ–°å»ºsrcç›®å½•åŠå¦‚ä¸‹æ–‡ä»¶
    # src/index.html !å¿«æ·é”®ç”Ÿæˆhtmlæ¨¡æ¿
        ```html
        ...
        <script src="./index.js"></script>
        ...
        ```

    # src/index.js
        ```js
        const arr = [new Promise(() => {}), new Promise(() => {})];
        arr.forEach((v) => console.log(v));
        let a = () => {
        return "æµ‹è¯•ç®­å¤´å‡½æ•°";
        };
        console.log(a());

        ```
6. æµè§ˆå™¨ä¸­æ‰“å¼€`index.html`ï¼Œé¢„è§ˆ
````

- **npm init**
  npm æ˜¯ node çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»¥ node è§„èŒƒçš„å½¢å¼åˆ›å»ºä¸€ä¸ªé¡¹ç›®æˆ–è€… node çš„åŒ…æ–‡ä»¶ï¼Œè¦æƒ³ç”¨ webpack ç®¡ç†é¡¹ç›®ï¼Œé¦–å…ˆå¾—è®©ä½ çš„é¡¹ç›®ç¬¦åˆ node çš„è§„èŒƒï¼Œæ‰€ä»¥ä½¿ç”¨ npm init å³å»åˆå§‹é¡¹ç›®ã€‚
  å¦‚ä¸‹ï¼Œ`npm init`ä¹‹åå³åœ¨ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª package.json æ–‡ä»¶ï¼Œæ¥æè¿° node é¡¹ç›®æˆ–è€… node åŒ…é‡Œé¢çš„ä¿¡æ¯ã€‚

  ```js
  {
  "name": "react-demo",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "private":true,
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "xulei",
  "license": "ISC"
  }

  ```

- **ä¿®æ”¹ package.json**
  - private: trueï¼Œæ„æ€æ˜¯è¿™ä¸ªé¡¹ç›®æ˜¯ç§æœ‰é¡¹ç›®ï¼Œä¸ä¼šè¢«å‘å¸ƒåˆ° npm çš„çº¿ä¸Šä»“åº“é‡Œã€‚
  - å¯ä»¥æŠŠ main è¿™ä¸ªé…ç½®é¡¹å»æ‰ï¼Œå› ä¸ºæˆ‘ä»¬è¿™ä¸ªé¡¹ç›®ä¸ä¼šè¢«å¤–éƒ¨å¼•ç”¨ï¼Œåªæ˜¯è‡ªå·±æ¥ç”¨ï¼Œæ²¡æœ‰å¿…è¦å‘å¤–æš´éœ²ä¸€ä¸ª js æ–‡ä»¶ï¼Œæ‰€ä»¥å»æ‰ï¼Œ
  - scripts è¿™ä¸ªé…ç½®é¡¹çš„å€¼ä¹Ÿå¯ä»¥å»æ‰ï¼Œ
  - Author é…ç½®é¡¹å¯ä»¥å†™æˆè‡ªå·±çš„åå­—
  - License é…ç½®é¡¹ï¼Œå¦‚æœä½ æƒ³å¼€æºï¼Œå¯ä»¥å†™æˆ mitï¼ŒISC ä¹Ÿæ˜¯å¯ä»¥çš„

## ã€äºŒã€‘å®‰è£…é…ç½® webpack

- é¡¹ç›®å†…å®‰è£… webpack
  `npm install webpack webpack-cli -D`
  å®‰è£…å®Œæˆåæ‰“å¼€`package.json`æ£€æŸ¥ï¼Œå¹¶è¾“å…¥`npx webpack -v`ç¡®è®¤

  ```js
  $ npx webpack -v
  webpack 5.24.2
  webpack-cli 4.5.0
  ```

- æ–°å»ºå¹¶é…ç½®`webpack.config.js`
  ```js
  const path = require("path");
  module.exports = {
    // mode: 'development', // å¼€å‘ç¯å¢ƒ
    entry: {
      main: "./src/index.js", // å…¥å£æ–‡ä»¶
    },
    output: {
      filename: "[name].js", // æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶å
      path: path.resolve(__dirname, "dist"), // å‡ºå£ç›®å½•: distæ–‡ä»¶å¤¹
      // publicPath: 'http://cdn.com.cn' // å¼•å…¥æ‰“åŒ…å‡ºæ¥çš„jsæ–‡ä»¶åç§°å‰åŠ ä¸Šcdnå‰ç¼€
    },
  };
  ```
- `npx webpack`æµ‹è¯•å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒæ‰“åŒ…æ˜¯å¦æ­£å¸¸

  å¦‚ä¸‹ï¼Œä¿®æ”¹ index.html ä¸­å¼•ç”¨çš„ è·¯å¾„ä¸º dist ä¸‹çš„ js æ–‡ä»¶ï¼Œæµ‹è¯•æ­£å¸¸
  | | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ
  | -- | -- | --
  | `asset main.js` å¤§å°| 1.37k | 109 bytes |

  - å¼€å‘ç¯å¢ƒä¸‹

    ```js
    $..\react-demo> npx webpack
    asset main.js 1.37 KiB [emitted] (name: main)
    ./src/index.js 174 bytes [built] [code generated]
    webpack 5.24.2 compiled successfully in 75 ms
    ```

    ```js
    // ./dist/main.js

    /******/ (() => {
      // webpackBootstrap
      /******/ var __webpack_modules__ = {
        /***/ "./src/index.js":
          /*!**********************!*\
    !*** ./src/index.js ***!
    \**********************/
          /***/ () => {
            eval(
              'const arr = [new Promise(() => {}), new Promise(() => {})];\r\n\r\narr.forEach((v) => console.log(v));\r\n\r\nlet a = () => {\r\n  return "æµ‹è¯•ç®­å¤´å‡½æ•°";\r\n};\r\nconsole.log(a());\r\n\n\n//# sourceURL=webpack://react-demo/./src/index.js?'
            );

            /***/
          },

        /******/
      }; // startup // Load entry module and return exports // This entry module can't be inlined because the eval devtool is used.
      /************************************************************************/
      /******/
      /******/ /******/ /******/ /******/ var __webpack_exports__ = {};
      /******/ __webpack_modules__["./src/index.js"]();
      /******/
      /******/
    })();
    ```

  - ç”Ÿäº§ç¯å¢ƒä¸‹

    ```js
    $..\react-demo> npx webpack
    asset main.js 109 bytes [compared for emit] [minimized] (name: main)
    ./src/index.js 174 bytes [built] [code generated]
    webpack 5.24.2 compiled successfully in 189 ms
    ```

    ```js
    // ./dist/main.js
    [new Promise(() => {}), new Promise(() => {})].forEach((o) =>
      console.log(o)
    ),
      console.log("æµ‹è¯•ç®­å¤´å‡½æ•°");
    ```

  - è€ç‰ˆæœ¬ webpack æ‰“åŒ…å›¾ç‰‡å¦‚ä¸‹
    ![](./imgs/old-npx-webpack.png)

## ã€ä¸‰ã€‘æ’ä»¶ï¼šæ¸…ç©º distã€è‡ªåŠ¨è¾“å‡º HTML

å®‰è£…ï¼š`npm install clean-webpack-plugin -D`

```js
// æŠ›é”™åŸå†™æ³•
const CleanWebpackPlugin = require("clean-webpack-plugin");
plugins: [new CleanWebpackPlugin(["dist"])];
// å¦ä¸€ç§é”™è¯¯å†™æ³•
plugins: [
  new CleanWebpackPlugin(["dist"], {
    root: path.resolve(__dirname, "../"),
  }),
];

// æ­£ç¡®å†™æ³•
const { CleanWebpackPlugin } = require("clean-webpack-plugin");
plugins: [new CleanWebpackPlugin()];
```

å®‰è£…ï¼š`npm install html-webpack-plugin -D`

```js
const HtmlWebpackPlugin = require("html-webpack-plugin");
plugins: [
  new CleanWebpackPlugin(),
  new HtmlWebpackPlugin({
    // æ‰“åŒ…è¾“å‡ºhtmlé…ç½®
    title: "resumeTwo", //
    // å‹ç¼© HTML æ–‡ä»¶
    // minify: {
    //   removeComments: true, // ç§»é™¤ HTML ä¸­çš„æ³¨é‡Š
    //   collapseWhitespace: true, // åˆ é™¤ç©ºç™½ç¬¦ä¸æ¢è¡Œç¬¦
    //   minifyCSS: true, // å‹ç¼©å†…è” css
    // },
    // filename: 'index.html', // ç”Ÿæˆåçš„æ–‡ä»¶å
    template: "src/index.html", // æ ¹æ®æ­¤æ¨¡ç‰ˆç”Ÿæˆ HTML æ–‡ä»¶
  }),
];
```

## ã€å››ã€‘ é…ç½®å¼€å‘æœåŠ¡å™¨

è§ã€æŒ‡å— - å¼€å‘ - å¼€å‘å·¥å…·ã€‘ `ä½¿ç”¨ webpackDevServer`

## ã€äº”ã€‘ `devtoolï¼šsourceMap`çš„é…ç½®

è§ã€æŒ‡å— - å¼€å‘ - ä½¿ç”¨ sourceMapã€‘ `ä½¿ç”¨ webpackDevServer`

## ã€å…­ã€‘Babel è½¬ç 

### â‘  å®‰è£…ä¾èµ–å¹¶é…ç½®

```powerShell
npm install babel-loader @babel/core @babel/preset-env -D
```

è§`Babelå®˜ç½‘\è®¾ç½®\é€‰æ‹©webpackæŸ¥çœ‹ç›¸åº”é…ç½®`ï¼Œé…ç½®å¦‚ä¸‹ï¼š

```js
module: {
    rules: [
      {
        test: /\.js$/, // åŒ¹é….jsç»“å°¾çš„æ–‡ä»¶
        exclude: /node_modules/, // æ’é™¤ä¾èµ–åŒ…æ–‡ä»¶å¤¹ï¼Œï¼Œå› ä¸ºnode-moduleåŒ…é‡Œé¢æ˜¯ç¬¬ä¸‰æ–¹çš„ä»£ç ï¼Œé‡Œé¢ES6è£…ES5çš„å·¥ä½œæ—©å°±åšå¥½äº†ï¼Œæ²¡å¿…è¦å†åšä¸€é
        // loader: "babel-loader", // ä½¿ç”¨babel-loaderï¼Œé…ç½®åœ¨.babelrc
        use: {
          loader: "babel-loader", // å¦‚æœæ£€æµ‹åˆ°æ–‡ä»¶æ˜¯jsæ–‡ä»¶çš„è¯ï¼Œæ¥ç”¨babel-loaderæ¥åšè¯­ä¹‰ä¸Šçš„åˆ†æ
          options: {
            presets: ["@babel/preset-env"],
          },
        },
      },
    ],
  },
```

é…ç½® Babel å‰åæ‰“åŒ…æ–‡ä»¶å¯¹æ¯”ã€‚

```js
// é…ç½®Babelå‰

/******/ (() => {
  // webpackBootstrap
  var __webpack_exports__ = {};
  /*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
  const arr = [new Promise(() => {}), new Promise(() => {})];

  arr.forEach((v) => console.log(v));

  let a = () => {
    return "æµ‹è¯•ç®­å¤´å‡½æ•°";
  };
  console.log(a());

  /******/
})()(
  // é…ç½®Babelå

  /******/ () => {
    // webpackBootstrap
    var __webpack_exports__ = {};
    /*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
    var arr = [new Promise(function () {}), new Promise(function () {})];
    arr.forEach(function (v) {
      return console.log(v);
    });

    var a = function a() {
      return "æµ‹è¯•ç®­å¤´å‡½æ•°";
    };

    console.log(a());
    /******/
  }
)();
```

å¦‚ä¸Šï¼Œå¯ä»¥çœ‹åˆ° `const` å·²ç»è½¬æˆäº† `var`ï¼Œç®­å¤´å‡½æ•°å·²ç»è½¬æˆäº†æ­£å¸¸çš„ `function`ã€‚è¿™ä¸ªæ—¶å€™åªèƒ½è½¬æ¢ä¸€äº›ç®€å•çš„ ES6 ç‰¹æ€§ã€‚ä½†æ˜¯å¦‚ `promise` å¯¹è±¡å’Œæ•°ç»„çš„ `map` æ–¹æ³•ï¼Œåœ¨ä½ç‰ˆæœ¬æµè§ˆå™¨é‡Œé¢è¿˜æ˜¯ä¸å­˜åœ¨çš„ï¼Œè™½ç„¶åšäº†ç¿»è¯‘ï¼Œä½†æ˜¯åªç¿»è¯‘äº†ä¸€éƒ¨åˆ†ï¼Œè¿˜æœ‰å¾ˆå¤šç‰¹æ€§åœ¨ä½ç‰ˆæœ¬æµè§ˆå™¨è¿˜æ˜¯ä¸èƒ½è¯†åˆ«ã€‚éœ€è¦å€ŸåŠ©`@babel/polyfill`

### â‘¡`@babel/polyfill`

```powerShell
npm install  @babel/polyfill -S
```

```js
// è­¦å‘Šå¦‚ä¸‹
npm WARN deprecated @babel/polyfill@7.12.1: ğŸš¨ This package has been deprecated in favor of separate inclusion of a polyfill and regenerator-runtime (when needed). See the @babel/polyfill docs (https://babeljs.io/docs/en/babel-polyfill) for more information.
npm WARN deprecated core-js@2.6.12: core-js@<3 is no longer maintained and not recommended for usage due to the number of issues. Please, upgrade your dependencies to the actual version of core-js@3.
```

```js
// å®‰è£…å®Œæˆä¹‹åéœ€è¦åœ¨æ‰€æœ‰ä»£ç è¿è¡Œä¹‹å‰è®¾ç½®å¦‚ä¸‹ï¼Œ
// å³æ”¾åˆ°src/index.jsæœ€é¡¶éƒ¨ï¼Œå³ä¸šåŠ¡ä»£ç æœ€é¡¶éƒ¨ï¼Œä¾‹å­ï¼šé¡¶ç‚¹æ ‡å‡†ç‰ˆé‡Œsrc/index.jsä¸­ä¹Ÿç”¨åˆ°äº†è¿™ä¸ª
import "@babel/polyfill";

// å®‰è£…@babel/polyfillå‰åå¯¹æ¯”
// å‰
asset main.js 1.33 KiB [emitted] (name: main)
asset index.html 319 bytes [emitted]
./src/index.js 202 bytes [built] [code generated]
webpack 5.24.2 compiled successfully in 859 ms

// å
asset main.js 831 KiB [emitted] (name: main)
asset index.html 319 bytes [emitted]
runtime modules 937 bytes 4 modules
...
webpack 5.24.2 compiled successfully in 1612 ms

```

å¦‚ä¸Šå¯¹æ¯”ï¼Œå…¨å±€å¼•å…¥ @babel/polyfill çš„è¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¼å…¥ä»£ç ä¸­ä¸éœ€è¦çš„ polyfillï¼Œä»è€Œä½¿æ‰“åŒ…ä½“ç§¯æ›´å¤§ã€‚==å¯ä»¥çœ‹åˆ°å› ä¸º`@babel/polyfill` è¦å»å¼¥è¡¥ä¸€äº›ä½ç‰ˆæœ¬æµè§ˆå™¨ä¸å­˜åœ¨çš„ä¸€äº›å†…å®¹ï¼Œæ‰€ä»¥ä»–è¦è‡ªå·±å»åš promise çš„å®ç°ï¼Œæ•°ç»„ map æ–¹æ³•çš„å®ç°==ï¼Œç„¶åå†æŠŠè¿™äº›å®ç°æ”¾åˆ° main.js é‡Œé¢ï¼Œæ‰€ä»¥ main.js å°±ä¼šå˜å¾—ç‰¹åˆ«çš„å¤§ã€‚

ä½†æ˜¯æˆ‘ä»¬æºç é‡Œé¢å…¶å®åªç”¨åˆ°äº† promise å’Œ map è¯­æ³• ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–æ²¡æœ‰ç”¨çš„è¯­æ³•éƒ½è¢«æ‰“åŒ…åˆ° main.js é‡Œé¢äº†ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä¸éœ€è¦è¿™äº›æ²¡ä½¿ç”¨åˆ°çš„è¯­æ³•è¢«æ‰“åŒ…ï¼Œå³ main.js ä¸éœ€è¦å…«ç™¾å¤š k è¿™ä¹ˆå¤§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªéå¸¸ç®€å•çš„é…ç½®ï¼Œä¼˜åŒ–è¿™ä¸ªæ€§èƒ½ï¼Œå¦‚ä¸‹ã€‚

- `useBuiltIns: 'usage'` ä¼˜åŒ–æ€§èƒ½ï¼ˆåªè½¬è¯‘æºä»£ç ä¸­ä½¿ç”¨åˆ°çš„ï¼‰

```js
module: {
    rules: [
      {
        test: /\.js$/, // åŒ¹é….jsç»“å°¾çš„æ–‡ä»¶
        exclude: /node_modules/, // æ’é™¤ä¾èµ–åŒ…æ–‡ä»¶å¤¹
        // loader: "babel-loader", // ä½¿ç”¨babel-loaderï¼Œé…ç½®åœ¨.babelrc
        use: {
          loader: "babel-loader",
          options: {
            presets: [
              [
                "@babel/preset-env",
                {
                  useBuiltIns: "usage", // åªæŠŠè½¬æ¢åç”¨åˆ°çš„ç‰¹æ€§æ‰“åŒ…è¿›å»
                },
              ],
            ],
          },
        },
      },
    ],
  },
```

é‡æ–°æ‰“åŒ…å‘ç°`dist/main.js`ä»å…«åƒå¤šè¡Œå˜æˆäº†ä¸€åƒå¤šè¡Œï¼Œä¼˜åŒ–äº†å¾ˆå¤šã€‚å¦‚ä¸‹

```js
asset main.js 126 KiB [emitted] (name: main)
asset index.html 319 bytes [emitted]
runtime modules 937 bytes 4 modules
modules by path ./node_modules/core-js/modules/*.js 32.5 KiB 56 modules
./src/index.js 341 bytes [built] [code generated]
webpack 5.24.2 compiled successfully in 1088 ms
```

### â‘¢`@babel/plugin-transform-runtime`

> **æ€»ç»“ï¼š**
>
> - å¦‚æœå†™çš„æ˜¯ä¸šåŠ¡ä»£ç ï¼Œé…ç½® preset åŒæ—¶å¼•å…¥@babel/polyfill å°±è¡Œäº†ï¼Œ
> - å¦‚æœå†™çš„æ˜¯ä¸€ä¸ªåº“é¡¹ç›®ä»£ç ï¼Œå°±è¦ä½¿ç”¨@babel/plugin-transform-runtime è¿™ä¸ªæ’ä»¶ï¼Œå¥½å¤„æ˜¯å¯é¿å…@babel/polyfill å¸¦æ¥çš„é—®é¢˜ï¼ˆä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒï¼‰ï¼Œè¿™ä¸ªæ’ä»¶ä¼šä»¥é—­åŒ…æ³¨å…¥æˆ–è€…é—´æ¥çš„å¸®åŠ©ç»„ä»¶å¼•å…¥å¯¹åº”çš„å†…å®¹ï¼Œå®ƒä¸å­˜åœ¨å…¨å±€æ±¡æŸ“è¿™æ ·ä¸€ä¸ªæ¦‚å¿µï¼Œæ˜¯ä¸ªæ›´å¥½çš„æ–¹æ¡ˆ

å¼€å‘ç¬¬ä¸‰æ–¹æ¨¡å—/UI ç»„ä»¶åº“/ç±»åº“çš„æ—¶å€™ç”¨`@babel/polyfill` è¿™ç§æ–¹æ¡ˆæ˜¯æœ‰é—®é¢˜çš„ï¼Œ==å› ä¸ºå®ƒåœ¨æ³¨å…¥ promise æˆ–è€…è¿™ç§ map æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šé€šè¿‡å…¨å±€å˜é‡æ¥æ³¨å…¥ï¼Œä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒ==ï¼Œæ‰€ä»¥è¦æ¢ä¸€ç§æ‰“åŒ…çš„æ–¹å¼ã€‚

```powerShell
npm install @babel/plugin-transform-runtime -D
npm install @babel/runtime -S
```

ç„¶åæ³¨é‡Šæ‰ preset çš„é…ç½®äº†ï¼Œå–è€Œä»£ä¹‹åŠ ä¸€ä¸ª pluginï¼Œå¦‚ä¸‹ï¼šå¹¶æ¥æ”¶å‚æ•°åšé…ç½®

```powerShell
npm install core-js@3 -S
```

............
ç›´æ¥åœ¨`webpack.config.js`ä¸­é…ç½®è¿˜æ˜¯æŠ¥é”™ï¼Œç›´æ¥çœ‹åœ¨`.babelrc`å¦‚ä½•é…ç½®å°±å¥½

### â‘£ åˆ›å»º`.babelrc` æ–‡ä»¶æ¥é…ç½® Babel

Babel çš„é…ç½®é¡¹ç‰¹åˆ«å¤šï¼Œå¯¼è‡´ options é‡Œé¢çš„é…ç½®é¡¹éå¸¸é•¿ï¼Œå¦‚ä½•è§£å†³ï¼Ÿåœ¨æ ¹ç›®å½•ä¸‹æ–°å»º.babelrc æ–‡ä»¶ï¼Œç„¶åå°† options å¯¹è±¡çš„é…ç½®æ‹¿å‡ºæ¥ï¼Œæ”¾åˆ°`.babelrc` é‡Œé¢å»ï¼Œæ³¨æ„é‡Œé¢ä¸èƒ½å†™æ³¨é‡Šã€‚

```powerShell
# webpack.config.js
module: {
    rules: [
      {
        test: /\.js$/, // åŒ¹é….jsç»“å°¾çš„æ–‡ä»¶
        exclude: /node_modules/, // æ’é™¤ä¾èµ–åŒ…æ–‡ä»¶å¤¹
        loader: "babel-loader", // ä½¿ç”¨babel-loaderï¼Œé…ç½®åœ¨.babelrc
      },
    ],
  },
```

```powerShell
# .babelrc
{
  "presets": [
    [
      "@babel/preset-env",
      {
        "useBuiltIns": "usage", // åªæŠŠè½¬æ¢åç”¨åˆ°çš„ç‰¹æ€§æ‰“åŒ…è¿›å»
        "corejs": 3
      }
    ]
  ],
  "plugins": ["@babel/plugin-transform-runtime"]
}

```

æ³¨æ„å°†`src/index.js`é¡¶éƒ¨çš„`import "@babel/polyfill";`å»æ‰ã€‚

```powerShell
# æ‰“åŒ…ç»“æœå¦‚ä¸‹
asset main.js 215 KiB [emitted] (name: main)
asset index.html 319 bytes [emitted]
runtime modules 1.13 KiB 5 modules
modules by path ./node_modules/core-js/internals/*.js 42.9 KiB 82 modules
modules by path ./node_modules/core-js/modules/*.js 14.6 KiB
  ./node_modules/core-js/modules/es.promise.js 13.2 KiB [built] [code generated]
  ./node_modules/core-js/modules/es.object.to-string.js 380 bytes [built] [code generated]
  ./node_modules/core-js/modules/es.array.for-each.js 293 bytes [built] [code generated]
  ./node_modules/core-js/modules/web.dom-collections.for-each.js 691 bytes [built] [code generated]
./src/index.js 396 bytes [built] [code generated]
webpack 5.24.2 compiled successfully in 1110 ms
```

æ‰“åŒ…å‘ç°`dist/main.js`ä¸º 2600 è¡Œ

## ã€ä¸ƒã€‘å¤„ç†é™æ€èµ„æºï¼šå›¾ç‰‡

```powerShell
npm install file-loader url-loader -D
```

- ã€file-loaderã€‘ï¼šè§£å†³ CSS ç­‰æ–‡ä»¶å¼•å…¥å›¾ç‰‡è·¯å¾„çš„é—®é¢˜ã€file-loader æ˜¯è§£æå›¾ç‰‡åœ°å€ï¼ŒæŠŠå›¾ç‰‡ä»æºæ–‡ä»¶æ‹·è´åˆ°ç›®æ ‡æ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥ä¿®æ”¹æºæ–‡ä»¶åç§°ï¼Œå¯ä»¥å¤„ç†äºŒè¿›åˆ¶ã€bootstrap é‡Œé¢çš„å­—ä½“ã€‘

- ã€Url-loaderã€‘ï¼šå½“å›¾ç‰‡è¾ƒå°æ—¶ä¼šæŠŠå›¾ç‰‡ BASE64 ç¼–ç ï¼ˆå‡å°‘å›¾ç‰‡ http è¯·æ±‚ï¼‰ï¼Œå¤§äº limit å‚æ•°æ—¶å€™è¿˜æ˜¯ä½¿ç”¨ file-loader è¿›è¡Œæ‹·è´ï¼ˆå›¾ç‰‡å¾ˆå¤§æ—¶ç”¨ urlï¼Œæ‰“åŒ…çš„ js æ–‡ä»¶å°±ä¼šå¾ˆå¤§ï¼ŒåŠ è½½é€Ÿåº¦å°±å˜æ…¢å³ä¸€å¼€å§‹é¡µé¢ä¸æ˜¾ç¤ºï¼‰ï¼Œlimit å‚æ•°å•ä½æ˜¯å­—èŠ‚ï¼Œ1024 å­—èŠ‚=1k

**é…ç½®å¦‚ä¸‹ï¼š**

```js
module: {
    rules: [
      {
        test: /\.(jpg|png|gif|jpeg|svg)$/, // åŒ¹é…å›¾ç‰‡æ–‡ä»¶
        use: {
          loader: "url-loader",
          options: {
            name: "[name].[ext]",
            outputPath: "images/", // å›¾ç‰‡è¾“å‡ºè·¯å¾„ï¼Œåœ¨/distä¸‹
            limit: 1024 * 10, // è¶…è¿‡10kç”¨file-loaderï¼Œåä¹‹ç”¨url-loader
          },
        },
      },
    ],
  },
  resolve: {
    extensions: [".tsx", ".ts", ".js", ".jsx", ".mdx"],
    alias: {
      "@": path.resolve(__dirname, "src"), // è®¾ç½®@ä¸ºsrcç›®å½•çš„åˆ«å
    },
  },
```

**æµ‹è¯•å¦‚ä¸‹ï¼š**
é‡æ–°æ‰“åŒ…å‘ç°å›¾ç‰‡åŠ è½½æ­£å¸¸

```js
// src/index.js
import waterbyside from "@/assets/images/waterbyside.jpg";

const waterImg = document.createElement("img");
// const waterImg = new Image();
waterImg.src = waterbyside;
waterImg.width = 500;
waterImg.heigth = 200;
const root = document.getElementById("root");
root.appendChild(waterImg);
```

## ã€å…«ã€‘å¤„ç†é™æ€èµ„æºï¼šæ ·å¼

å°†ä¸Šä¸€èŠ‚å›¾ç‰‡çš„æ ·å¼ä» js ä¸­ç§»åˆ° css ä¸­ï¼šæ–°å»º index.css æ ·å¼æ–‡ä»¶å¹¶å¼•å…¥æ ·å¼å¹¶ç»™ img æ·»åŠ æ ·å¼ç±»ã€‚

æ­¤æ—¶ç›´æ¥æ‰“åŒ…è‚¯å®šä¼šæŠ¥æ— æ³•è¯†åˆ« `inde.css` æ–‡ä»¶ï¼Œè·Ÿ babel ä¸€æ ·ï¼Œwebpack ä¸çŸ¥é“å°† CSS æå–åˆ°æ–‡ä»¶ä¸­ã€‚éœ€è¦ä½¿ç”¨ loader æ¥åŠ è½½å¯¹åº”çš„æ–‡ä»¶ã€‚æ‰€ä»¥éœ€è¦åœ¨ `webpack.config.js` é‡Œé¢çš„ module ä¸­çš„ rules ä¸­æ–°å»ºä¸€ä¸ªè§„åˆ™ï¼Œæ¥é…ç½®å¦‚ä½•æ‰“åŒ… css æ–‡ä»¶ã€‚

> **èƒŒæ™¯ï¼š**

CSS åœ¨ HTML ä¸­çš„å¸¸ç”¨å¼•å…¥æ–¹æ³•æœ‰ `<link>` æ ‡ç­¾å’Œ `<style>` æ ‡ç­¾ä¸¤ç§ï¼Œæ‰€ä»¥è¿™æ¬¡å°±æ˜¯ç»“åˆ webpack ç‰¹ç‚¹å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

- å°† css é€šè¿‡ link æ ‡ç­¾å¼•å…¥
  å¦‚æœéœ€è¦å•ç‹¬æŠŠ CSS æ–‡ä»¶åˆ†ç¦»å‡ºæ¥é€šè¿‡ link æ ‡ç­¾å¼•å…¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Â `mini-css-extract-plugin`Â  æ’ä»¶ã€‚
- å°† css æ”¾åœ¨ style æ ‡ç­¾é‡Œ

### å¤„ç† css æ–‡ä»¶ï¼ˆé€šè¿‡ style æ ‡ç­¾ï¼‰

```js
// src/index.js
import waterbyside from "@/assets/images/waterbyside.jpg";
import "./index.css";

const waterImg = document.createElement("img");
// const waterImg = new Image();
waterImg.src = waterbyside;
waterImg.classList.add("waterbyside");

const root = document.getElementById("root");
root.appendChild(waterImg);
```

```css
/* index.css */
@import "./waterbyside.css";

/* waterbyside.css */
.waterbyside {
  width: 280px;
  height: 160px;
}
```

> **å®‰è£…ï¼š**

```powerShell
npm install css-loader style-loader -D
```

é‡æ–°æ‰“åŒ…å°±å‘ç°æ ·å¼ç”Ÿæ•ˆï¼Œå¯ä»¥å‘ç°å¹¶æ²¡æœ‰ç”Ÿæˆ CSS æ–‡ä»¶ï¼Œä½†æ˜¯æ‰“å¼€ index.html æ˜¯æœ‰æ ·å¼çš„ï¼Œå› ä¸º css æ”¾åœ¨äº† style æ ‡ç­¾é‡Œé¢ã€‚

æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œä¸¤ä¸ª loader é…åˆèµ·æ¥ä½¿ç”¨ã€‚`css-loader`ä¼šåˆ†æå‡ºå‡ ä¸ª css æ–‡ä»¶ ä¹‹é—´çš„å…³ç³»ï¼Œæœ€ç»ˆå°†å¤šä¸ª css æ–‡ä»¶åˆæˆä¸€ä¸ª cssï¼Œ`style-loader` åœ¨å¾—åˆ° `css-loader` ç”Ÿæˆçš„ css ä¹‹åï¼Œä¼šæŠŠ css æŒ‚è½½åˆ° `<head></head>`é‡Œé¢çš„`<style></style>`ä¸­ã€‚

### å¤„ç† css æ–‡ä»¶ï¼ˆé€šè¿‡ link æ ‡ç­¾ï¼‰

```powerShell
npm i mini-css-extract-plugin -D
```

```js
const MiniCssExtractPlugin = require("mini-css-extract-plugin"); // å°† css å•ç‹¬æ‰“åŒ…æˆæ–‡ä»¶é€šè¿‡linkæ–¹å¼å¼•å…¥
```

æ­¤ç§æ–¹å¼å¤„ç†ä¼šå°†æ‰€æœ‰ css æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª css æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰å‹ç¼©ï¼Œä½¿ç”¨`optimize-css-assets-webpack-plugin`æ’ä»¶æ¥å®ç° css å‹ç¼©ã€‚

```powerShell
npm i optimize-css-assets-webpack-plugin -D
```

> **é…ç½®å¦‚ä¸‹ï¼š**

```js

const MiniCssExtractPlugin = require("mini-css-extract-plugin"); // å°† css å•ç‹¬æ‰“åŒ…æˆæ–‡ä»¶é€šè¿‡linkæ–¹å¼å¼•å…¥
const OptimizeCssAssetsPlugin = require("optimize-css-assets-webpack-plugin"); // å‹ç¼© css

module: {
    rules: [
      ...
      {
        test: /\.(sa|sc|c)ss$/,
        use: [
          {
            loader: MiniCssExtractPlugin.loader, // å°†cssç”¨linkçš„æ–¹å¼å¼•å…¥å°±ä¸å†éœ€è¦style-loaderäº†
          },
          {
            loader: "css-loader",
            options: {
              importLoaders: 2, // é…ç½®ã€Œcss-loader ä½œç”¨äº @import çš„èµ„æºä¹‹å‰ã€æœ‰å¤šå°‘ä¸ª loaderã€‚
              modules: true, // å¯ç”¨ CSS æ¨¡å—åŒ–è§„èŒƒ
            },
          },
          "postcss-loader",
          "sass-loader",
        ],
      },
    ],
  },
  plugins: [
    ...
    new MiniCssExtractPlugin({
      filename: "./css/[name].css", // å‰é¢åŠ ä¸Šç›®å½•
      chunkFilename: "[id].css",
    }),
    new OptimizeCssAssetsPlugin({
      assetNameRegExp: /\.css$/g,
      cssProcessor: require("cssnano"), //ç”¨äºä¼˜åŒ–\æœ€å°åŒ– CSS çš„ CSS å¤„ç†å™¨ï¼Œé»˜è®¤ä¸º cssnano
      cssProcessorOptions: { safe: true, discardComments: { removeAll: true } }, //ä¼ é€’ç»™ cssProcessor çš„é€‰é¡¹ï¼Œé»˜è®¤ä¸º{}
      canPrint: true, //å¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ’ä»¶æ˜¯å¦å¯ä»¥å°†æ¶ˆæ¯æ‰“å°åˆ°æ§åˆ¶å°ï¼Œé»˜è®¤ä¸º true
    }),
  ],
```

#### å•ç‹¬åˆ†ç¦»å¤šä¸ª CSS æ–‡ä»¶

è¿™é‡Œéœ€è¦è¯´çš„ç»†ä¸€ç‚¹,ä¸Šé¢æˆ‘ä»¬æ‰€ç”¨åˆ°çš„ mini-css-extract-plugin ä¼šå°†æ‰€æœ‰çš„ css æ ·å¼åˆå¹¶ä¸ºä¸€ä¸ª css æ–‡ä»¶ã€‚å¦‚æœä½ æƒ³æ‹†åˆ†ä¸ºä¸€ä¸€å¯¹åº”çš„å¤šä¸ª css æ–‡ä»¶,æˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ° extract-text-webpack-pluginï¼Œè€Œç›®å‰ mini-css-extract-plugin è¿˜ä¸æ”¯æŒæ­¤åŠŸèƒ½ã€‚æˆ‘ä»¬éœ€è¦å®‰è£…@next ç‰ˆæœ¬çš„ extract-text-webpack-plugin

### å¤„ç† `scss/less` æ–‡ä»¶

ä¿®æ”¹`index.css`æ–‡ä»¶ä¸º`index.scss`ï¼Œå¦‚ä¸‹

```css
$bgColor: #2086d7 !default;
body {
  .waterbyside {
    width: 280px;
    height: 160px;
  }
  background-color: $bgColor;
}
```

> **å®‰è£…ï¼š**

```powerShell
npm install node-sass sass-loader -D
```

é‡æ–°æ‰“åŒ…å‘ç°æ ·å¼ç”Ÿæ•ˆã€‚

### ä¸º CSS åŠ ä¸Šæµè§ˆå™¨å‰ç¼€
> **ä»¥ä¸‹æ˜¯æœ€æ–°è®¾ç½®ï¼ˆ2022/05/11ï¼‰**
```json
{
  "postcss": "^8.4.13",
  "postcss-loader": "^6.2.1",
  "postcss-preset-env": "^7.5.0"
}
```

> **ä»¥ä¸‹æ˜¯`"postcss-loader": "^5.3.0"`æ—§ç‰ˆæœ¬çš„è®¾ç½®**

> æƒ³ç»™æ ·å¼åŠ ä¸€äº›å‰ç¼€ï¼Œå¦‚`-webkit-transform`ï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿ
> è‡ªå·±æ‰‹åŠ¨å†™ä¼šå¾ˆéº»çƒ¦ï¼Œä½†æ˜¯æœ‰ loader å¯ä»¥å®ç°è¿™ç§è‡ªåŠ¨æ·»åŠ å‚å•†å‰ç¼€çš„åŠŸèƒ½ã€‚å³ï¼š `postcss-loader` å’Œ `autoprefixer`

```powerShell
npm install postcss-loader autoprefixer -D
```

```css
body {
  .waterbyside {
    width: 280px;
    height: 160px;
    transform: translate(100px, 100px);
  }
}
```

**é…ç½®æ–¹å¼ä¸€ï¼š**
ç›´æ¥å†™åœ¨ webpack.config.js ä¸­

æ­¤æ¬¡é€šè¿‡è¿™ç§æ–¹å¼å¤±è´¥ï¼ŒåŸå› æ˜¯ postcss-loader è¿™ä¸ªç‰ˆæœ¬ä¸æ”¯æŒåœ¨ webpack.config.js æ–‡ä»¶ä¸­è¿™ä¹ˆå†™ï¼Œæ¢å¦ä¸€ç§é…ç½®æ–¹å¼å³å¯ã€‚

```js
{
        test: /\.(sa|sc|c)ss$/,
        use: [
          "style-loader",
          "css-loader",
          {
            loader: "postcss-loader",
            options: {
              ident: "postcss",
              plugins: (loader) => [
                require("postcss-import")({ root: loader.resourcePath }),
                require("postcss-cssnext")(),
                require("autoprefixer")(),
                require("cssnano")(),
              ],
            },
          },
          "sass-loader",
        ],
      },
```

**é…ç½®æ–¹å¼äºŒï¼š**
åœ¨ webpack.config.js åŒçº§ç›®å½•ä¸‹ï¼Œæ–°å»º postcss.config.js é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ postcss-loader é‡Œçš„æ’ä»¶ï¼šautoprefixer å¸®æˆ‘ä»¬æ·»åŠ å‚å•†å‰ç¼€ã€‚

> autoprefixer éœ€è¦æ­é… Browserslist,æä¾›äº†ä¸¤ç§æ–¹å¼å»é…ç½® Browserslistï¼Œ
>
> - ï¼ˆå®˜ç½‘æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª.-browserslistrc æ–‡ä»¶ï¼Œå†å†™è¿›å»ç›¸å…³çš„é…ç½®ï¼Œ
> - æˆ–è€…åœ¨ package.json ä¸­è¿›è¡Œé…ç½®
> - å…¶ä»–çš„é…ç½®å¦‚ babel-preset-env å’Œ Stylelint å¯ä»¥å…±äº«è¿™ä»½è§„åˆ™

```js
// postcss.config.js
module.exports = {
  plugins: [require("autoprefixer")],
};
```

é‡æ–°æ‰“åŒ…ï¼Œå¯ä»¥å‘ç°æ ·å¼åŠ ä¸Šäº†å‚å•†å‰ç¼€ã€‚

```css
body .waterbyside {
  width: 280px;
  height: 160px;
  -webkit-transform: translate(100px, 100px);
  transform: translate(100px, 100px);
}
```

### css-loader ä¸­ä½¿ç”¨ `importLoaders` å±æ€§

```js
{
  test: /\.(sa|sc|c)ss$/,
  use: [
    "style-loader",
    {
      loader: "css-loader",
      options: {
        importLoaders: 2,
      },
    },
    "postcss-loader",
    "sass-loader",
  ],
},
```

importLoaders: 2 è¡¨ç¤ºï¼šåœ¨ä¸€ä¸ª css/scss ä¸­å¼•å…¥äº†ï¼ˆ@importï¼‰å¦ä¸€ä¸ª css/scssï¼Œä¹Ÿä¼šä¾æ¬¡æ‰§è¡Œä¹‹å‰ä¸¤ä¸ª loaderï¼Œå³ `postcss-loader` å’Œ `sass-loader`ã€‚

### CSS æ¨¡å—åŒ–

å°† index.js ä¸­å¼•å…¥å›¾ç‰‡å¹¶æ’å…¥ root èŠ‚ç‚¹çš„ä»£ç å¤åˆ¶åˆ°ä¸€ä¸ª js æ–‡ä»¶å¹¶å°è£…æˆå‡½æ•°ï¼Œåœ¨ index.js å¼•å…¥å¹¶æ‰§è¡Œï¼Œä»æ–°æ‰“åŒ…ï¼Œå¯ä»¥å‘ç°å‡ºç°ä¸¤å¼ å›¾ç‰‡ä¸”æ ·å¼ä¸€æ ·ï¼Œå¦‚ä¸‹ã€‚

```js
import waterbyside from "@/assets/images/waterbyside.jpg";
import "./index.scss";
import getWaterSidePicFun from "./getWaterSidePic";

...

const waterImg = document.createElement("img");
// const waterImg = new Image();
waterImg.src = waterbyside;
waterImg.classList.add("waterbyside");

const root = document.getElementById("root");
root.appendChild(waterImg);

getWaterSidePicFun();

```

![](./imgs/webpack-css-module-example-1.png)

åŸå› æ˜¯ index.js ä¸­å¼•å…¥æ ·å¼æ˜¯è¿™ä¹ˆå†™çš„ï¼š`import "./index.scss";` æ‰€ä»¥å½“å‰æ–‡ä»¶ä¸­æ‰€æœ‰ç”¨äº† index.scss ä¸­æ ·å¼ç±»çš„å…ƒç´ éƒ½ä¼šæœ‰æ•ˆæœã€‚å³ä½¿åœ¨å°è£…æˆå¼•å…¥å›¾ç‰‡å‡½æ•°çš„ js æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰å¼•å…¥æ ·å¼ã€‚å³ï¼š==ä¸€ä¸ªæ–‡ä»¶é‡Œçš„æ ·å¼ï¼Œå½±å“åˆ°äº†å¦å¤–ä¸€ä¸ªæ–‡ä»¶é‡Œçš„æ ·å¼ï¼Œè™½ç„¶æ˜¯å¼•ç”¨çš„ï¼Œä½†æ˜¯ç­‰äºæ˜¯è®¾ç½®äº†å…¨å±€çš„æ ·å¼ã€‚å…¨å±€å…±äº«ï¼Œå³è¢«æ±¡æŸ“äº†==ï¼Œè¿™ä¹ˆå†™ä»£ç ä¼šäº§ç”Ÿé—®é¢˜ï¼Œå¦‚ä¸€ä¸å°å¿ƒæ”¹ä¸€ä¸ªæ–‡ä»¶é‡Œçš„æ ·å¼ï¼Œä¼šæŠŠå¦ä¸€ä¸ªæ–‡ä»¶é‡Œçš„æ ·å¼ä¹Ÿç»™æ”¹äº†ï¼Œå‡ºç°æ ·å¼å†²çªçš„é—®é¢˜ã€‚

æ‰€ä»¥å¼•å…¥äº†ä¸€ä¸ª CSSmodule çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯æ¨¡å—åŒ–çš„ cssï¼Œ==å³å¼•å…¥çš„ css åªåœ¨å¼•å…¥åœ°æ–¹å†…æœ‰æ•ˆï¼Œå¥½å¤„æ˜¯ï¼šè¿™ä¸ªæ–‡ä»¶æˆ–è€…æ¨¡å—é‡Œçš„æ ·å¼å’Œå…¶å®ƒæ–‡ä»¶/æ¨¡å—é‡Œçš„æ ·å¼ä¸ä¼šæœ‰ä»»ä½•çš„è€¦åˆå’Œå†²çªï¼Œå†™æ ·å¼çš„æ—¶å€™å˜å¾—å¾ˆç‹¬ç«‹ï¼Œå¯ä»¥é¿å…å¾ˆå¤šçš„é—®é¢˜==ã€‚

> **å®ç° css æ¨¡å—åŒ–ï¼š**

é…ç½® css-loaderï¼Œæ–°å¢ä¸ªå±æ€§ `modulesï¼štrue`ã€‚ç„¶åå¼•å…¥æ ·å¼çš„æ–¹å¼ä¹Ÿéœ€è¦å˜æ›´ã€‚`import './index.scss'` æ”¹ä¸º `import styles from './index.scss'`ï¼Œåº”ç”¨æ ·å¼ç”¨ `styles.ç±»å`;

```js
import waterbyside from "@/assets/images/waterbyside.jpg";
import styles from "./index.scss";
import getWaterSidePicFun from "./getWaterSidePic";

...

const waterImg = document.createElement("img");
// const waterImg = new Image();
waterImg.src = waterbyside;
waterImg.classList.add(styles.waterbyside);

const root = document.getElementById("root");
root.appendChild(waterImg);

getWaterSidePicFun();
```

![](./imgs/webpack-css-module-example-2.png)

å¦‚ä¸Šï¼Œå¯ä»¥å‘ç°ï¼Œloader ä¼šç”¨å”¯ä¸€çš„æ ‡è¯†ç¬¦(identifier)æ¥æ›¿æ¢å±€éƒ¨é€‰æ‹©å™¨ï¼šå³ç±»åã€‚æ¨¡å—åŒ–ç”Ÿæ•ˆã€‚

### å¦‚ä½•æ‰“åŒ…å­—ä½“æ–‡ä»¶ï¼šiconfont

### æ ·å¼ loader æ€»ç»“

- `css-loader`ï¼šè´Ÿè´£è§£æ CSS ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¤„ç† CSS ä¸­çš„ä¾èµ–ï¼Œä¾‹å¦‚ @import å’Œ url() ç­‰å¼•ç”¨å¤–éƒ¨æ–‡ä»¶çš„å£°æ˜

- `style-loader`ï¼šä¼šå°† css-loader è§£æçš„ç»“æœè½¬å˜æˆ JS ä»£ç ï¼Œè¿è¡Œæ—¶**åŠ¨æ€æ’å…¥ style æ ‡ç­¾**æ¥è®© CSS ä»£ç ç”Ÿæ•ˆã€‚

- `sass-loader`ï¼šæ¥å¯¹ sass ä»£ç è¿›è¡Œç¿»è¯‘ï¼Œç¿»è¯‘æˆ css ä»£ç 

- `postcss-loader`: (css è‡ªåŠ¨åŠ ä¸Šå‰ç¼€)

> æ³¨æ„!!!
> module.rules.use æ•°ç»„ä¸­ï¼Œloader çš„ä½ç½®ã€‚æ ¹æ® webpack è§„åˆ™ï¼šæ”¾åœ¨æœ€åçš„ loader é¦–å…ˆè¢«æ‰§è¡Œï¼Œä»ä¸Šå¾€ä¸‹å†™çš„è¯æ˜¯ä¸‹é¢å…ˆæ‰§è¡Œï¼Œä»å·¦å¾€å³å†™çš„è¯æ˜¯å³è¾¹å…ˆæ‰§è¡Œã€‚
> `['style-loader', 'css-loader', 'sass-loader'] `
> æ‰§è¡Œé¡ºåºä¸º sass-loader --> css-loader --> style-loader
> é¦–å…ˆåº”è¯¥åˆ©ç”¨ sass-loader å°† scss ç¼–è¯‘ä¸º cssï¼Œå‰©ä¸‹çš„é…ç½®å’Œå¤„ç† css æ–‡ä»¶ç›¸åŒã€‚

```js
module: {
  rules: [
    {
      test: /\.scss$/,
      use: [
        {
          loader: "style-loader", // å°† JS å­—ç¬¦ä¸²ç”Ÿæˆä¸º style èŠ‚ç‚¹
        },
        {
          loader: "css-loader", // å°† CSS è½¬åŒ–æˆ CommonJS æ¨¡å—
        },
        {
          loader: "sass-loader", // å°† Sass ç¼–è¯‘æˆ CSS
        },
      ],
    },
  ];
}
```

## ã€ä¹ã€‘é…ç½® React

Babel å®˜ç½‘é‡Œé¢å·¦ä¾§çš„`é¢„è®¾ï¼ˆPresetsï¼‰`ä¸‹æœ‰ä¸ª reactï¼Œç‚¹å¼€ã€‚

```js
npm i react react-dom -S
npm i @babel/preset-react -D
```

é…ç½®å¦‚ä¸‹ï¼š

```js
module: {
  rules: [
    {
      test: /(\.js)|(\.jsx)$/, // åŒ¹é….js|xç»“å°¾çš„æ–‡ä»¶
      exclude: /node_modules/, // æ’é™¤ä¾èµ–åŒ…æ–‡ä»¶å¤¹
      loader: "babel-loader", // ä½¿ç”¨babel-loaderï¼Œé…ç½®åœ¨.babelrc
    },
  ];
}
```

```js
{
    "presets": [
    [
      "@babel/preset-env",
      {
        "useBuiltIns": "usage", // åªæŠŠè½¬æ¢åç”¨åˆ°çš„ç‰¹æ€§æ‰“åŒ…è¿›å»
        "corejs": 3
      }
    ],
    "@babel/preset-react"
  ],
}
```

æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š

```js
// index.js
import React from "react";
import ReactDOM from "react-dom";
import App from "./app";

ReactDOM.render(<App />, document.getElementById("root"));
```

```js
// app.jsx
import React from "react";
import waterbyside from "@/assets/images/waterbyside.jpg";
import styles from "@/css/index.scss";
import "./app.scss";

class App extends React.Component {
  componentDidMount() {
    const arr = [new Promise(() => {}), new Promise(() => {})];
    arr.forEach((v) => console.log(v));
    let a = () => {
      return "æµ‹è¯•ç®­å¤´å‡½æ•°";
    };
    console.log(a());
  }
  render() {
    return (
      <>
        <div>hello react</div>
        <img src={waterbyside} className={styles.waterbyside} />
      </>
    );
  }
}

export default App;
```

å¦‚ä¸‹ï¼Œ`npm start`è¿è¡Œæ­£å¸¸ï¼Œæ‰“åŒ…ä¹Ÿæ­£å¸¸ã€‚
![](./imgs/webpack-react-example-1.png)

```js
// é…ç½®Reactå‰æ‰“åŒ…å¤§å°

assets by chunk 222 KiB (name: main)
  asset main.js 221 KiB [emitted] (name: main)
  asset ./css/main.css 877 bytes [emitted] (name: main)
asset images/waterbyside.jpg 134 KiB [emitted] [from: src/assets/images/waterbyside.jpg] (auxiliary name: main)
asset index.html 395 bytes [emitted]

/* ç„¶å devtool: "cheap-module-source-map" */

// é…ç½®Reactå
assets by chunk 1.08 MiB (name: main)
  asset main.js 1.08 MiB [emitted] (name: main) 1 related asset
  asset ./css/main.css 1.28 KiB [emitted] (name: main) 1 related asset
asset images/waterbyside.jpg 134 KiB [emitted] [from: src/assets/images/waterbyside.jpg] (auxiliary name: main)
asset index.html 395 bytes [emitted]

// é…ç½®Reactå(ç”Ÿäº§)
assets by chunk 153 KiB (name: main)
  asset main.js 152 KiB [emitted] [minimized] (name: main) 2 related assets
  asset ./css/main.css 948 bytes [emitted] (name: main) 1 related asset
asset images/waterbyside.jpg 134 KiB [emitted] [from: src/assets/images/waterbyside.jpg] (auxiliary name: main)
asset index.html 345 bytes [emitted]
```

## ã€åã€‘é…ç½®è·¯ç”±åŠ Antd

```powerShell
npm i react-router-dom -S
```

antd å®‰è£…é…ç½®è§`React/å·¥ç¨‹åŒ–`ã€‚
å¹¶å…³é—­ css æ¨¡å—åŒ–ã€‚

```js
// src\app.js
import React from "react";
import { HashRouter as Router, Route, Link } from "react-router-dom";
import { Layout } from "antd";
import routes from "@/route";
import waterbyside from "@/assets/images/waterbyside.jpg";
import "@/app.scss";

const { Header, Content } = Layout;

class App extends React.Component {
  componentDidMount() {
    const arr = [new Promise(() => {}), new Promise(() => {})];
    arr.forEach((v) => console.log(v));
    let a = () => {
      return "æµ‹è¯•ç®­å¤´å‡½æ•°";
    };
    console.log(a());
  }
  render() {
    return (
      <>
        {
          <Router>
            <Layout>
              <Header className="header">
                {routes.map((v) => (
                  <Link to={v.path} key={v.title} className="link">
                    {v.title}
                  </Link>
                ))}
                <img src={waterbyside} className="waterbyside" />
              </Header>
              <Content>
                {routes.map((v) => {
                  if (v.exact) {
                    return (
                      <Route
                        exact
                        key={v.path}
                        path={v.path}
                        component={v.component}
                      />
                    );
                  }
                  return (
                    <Route key={v.path} path={v.path} component={v.component} />
                  );
                })}
              </Content>
            </Layout>
          </Router>
        }
      </>
    );
  }
}

export default App;
```

```css
/* src/app.scss */
body,
div,
dl,
dd,
dt,
ul,
li,
ol,
h1,
h2,
h3,
h4,
h5,
h6,
form,
fieldset,
table,
td,
img,
input,
a,
p,
textarea {
  margin: 0;
  padding: 0;
  /*font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;*/
}
body {
  font-size: 16px;
}
ul,
ol,
li {
  list-style: none;
}
img {
  border: none;
}
a {
  text-decoration: none;
  color: #656565;
}

/*æ¸…æ¥šæµ®åŠ¨*/
.clearfloat:after {
  content: "";
  height: 0;
  display: block;
  visibility: hidden;
  overflow: hidden;
  clear: both;
}
.clearfloat {
  zoom: 1;
}
.fl {
  float: left;
}
.fr {
  float: right;
}

/* header */
.header {
  background: #1890ff;
  display: flex;
  align-items: center;
  .link {
    color: #fff;
    font-size: 18px;
    display: inline-block;
    padding: 0 20px;
    transition: all 0.3s ease-in;
    &:hover {
      color: #1890ff;
      background: #fff;
      transition: all 0.1s ease-in;
    }
  }
}

.waterbyside {
  width: 112px;
  height: 64px;
}
```

```js
// src/route.js
import Resume from "@/pages/resume";
import Project from "@/pages/project";
import TableAndCharts from "@/pages/tableAndCharts";
const routes = [
  {
    path: "/",
    title: "resume",
    component: Resume,
    exact: true,
  },
  {
    path: "/project",
    title: "project",
    component: Project,
  },
  {
    path: "/tableAndCharts",
    title: "tableAndCharts",
    component: TableAndCharts,
  },
];
export default routes;
```

æ‰“åŒ…å¦‚ä¸‹ã€‚

```js
assets by chunk 1.41 MiB (name: main)
  asset main.js 1.36 MiB [emitted] (name: main) 1 related asset
  asset ./css/main.css 43.7 KiB [emitted] (name: main) 1 related asset
asset images/waterbyside.jpg 134 KiB [emitted] [from: src/assets/images/waterbyside.jpg] (auxiliary name: main)
asset index.html 395 bytes [emitted]
Entrypoint main 1.41 MiB (1.64 MiB) = ./css/main.css 43.7 KiB main.js 1.36 MiB 3 auxiliary assets
orphan modules 257 KiB [orphan] 78 modules
runtime modules 2.04 KiB 6 modules
modules by path ./node_modules/ 1.21 MiB (javascript) 42.4 KiB (css/mini-extract)
```

## ã€åä¸€ã€‘é…ç½® Eslint

è¯¦è§[./å·¥ç¨‹åŒ–/ä¾èµ–/eslint.md]()

## ã€åä¸€ã€‘é…ç½® TS

è¯¦è§[./TS/intro/å®‰è£…é…ç½®]()

# **Tips**

## è®¾ç½®ç»å¯¹è·¯å¾„

è®¾ç½®ç»å¯¹è·¯å¾„å¦‚ä¸‹

```js
const path = require("path");
//Â path:Â path.resolve(__dirname,Â 'dist') è·¯å¾„æ˜¯å½“å‰æ–‡ä»¶ä½ç½®åŒçº§çš„distæ–‡ä»¶å¤¹
path: path.resolve(__dirname, "../dist"); // è·¯å¾„æ˜¯å½“å‰æ–‡ä»¶ä½ç½®ä¸Šä¸€çº§çš„distæ–‡ä»¶å¤¹
```

## åˆ¤æ–­ç”Ÿäº§/å¼€å‘ç¯å¢ƒ

```js
const isDevMode = process.env.NODE_ENV !== "production";


module: {
    rules: [
      {
        test: /\.(sa|sc|c)ss$/,
        use: [
          isDevMode ? 'style-loader' : MiniCssExtractPlugin.loader,
          'css-loader',
          'postcss-loader',
          'sass-loader',
        ],
      },
    ],
  }
```

## é™æ€èµ„æºæ‹·è´

[å‚è€ƒé“¾æ¥](https://juejin.cn/post/6844904084927938567)

æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å·²æœ‰çš„ JS æ–‡ä»¶ã€CSS æ–‡ä»¶ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰ï¼Œä½†æ˜¯ä¸éœ€è¦ webpack ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ `public/index.html` ä¸­å¼•å…¥äº† public ç›®å½•ä¸‹çš„ js æˆ– css æ–‡ä»¶ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœç›´æ¥æ‰“åŒ…ï¼Œé‚£ä¹ˆåœ¨æ„å»ºå‡ºæ¥ä¹‹åï¼Œè‚¯å®šæ˜¯æ‰¾ä¸åˆ°å¯¹åº”çš„ js / css äº†ã€‚

```js
â”œâ”€â”€ public
â”‚   â”œâ”€â”€ config.js
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ js
â”‚   â”‚   â”œâ”€â”€ base.js
â”‚   â”‚   â””â”€â”€ other.js
â”‚   â””â”€â”€ login.html
```

ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ index.html ä¸­å¼•å…¥äº† ./js/base.jsã€‚

```js
<!-- index.html -->
<script src="./js/base.js"></script>
```

è¿™æ—¶å€™ï¼Œæˆ‘ä»¬ npm run devï¼Œä¼šå‘ç°æœ‰æ‰¾ä¸åˆ°è¯¥èµ„æºæ–‡ä»¶çš„æŠ¥é”™ä¿¡æ¯ã€‚

å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œ==æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†å…¶æ‹·è´è‡³æ„å»ºç›®å½•ï¼Œç„¶ååœ¨é…ç½® CleanWebpackPlugin æ—¶ï¼Œæ³¨æ„ä¸è¦æ¸…ç©ºå¯¹åº”çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å³å¯ï¼Œä½†æ˜¯å¦‚è‹¥è¿™ä¸ªé™æ€æ–‡ä»¶æ—¶ä¸æ—¶çš„è¿˜ä¼šä¿®æ”¹ä¸‹ï¼Œé‚£ä¹ˆä¾èµ–äºæ‰‹åŠ¨æ‹·è´ï¼Œæ˜¯å¾ˆå®¹æ˜“å‡ºé—®é¢˜çš„==ã€‚

å¹¸è¿çš„æ˜¯ï¼Œwebpack ä¸ºæˆ‘ä»¬è¿™äº›è®°æ€§ä¸å¥½åˆçˆ±å·æ‡’çš„äººæä¾›äº†å¥½ç”¨çš„æ’ä»¶ã€‚CopyWebpackPluginï¼Œ==å®ƒçš„ä½œç”¨å°±æ˜¯å°†å•ä¸ªæ–‡ä»¶æˆ–æ•´ä¸ªç›®å½•å¤åˆ¶åˆ°æ„å»ºç›®å½•==ã€‚

- > **å®‰è£…ä¾èµ–**

```powerShell
npm install copy-webpack-plugin -D
```

- > ä¿®æ”¹é…ç½®(å½“å‰ï¼Œéœ€è¦åšçš„æ˜¯å°† public/js ç›®å½•æ‹·è´è‡³ dist/js ç›®å½•)ï¼š

```js
//webpack.config.js
const CopyWebpackPlugin = require("copy-webpack-plugin");
module.exports = {
  //...
  plugins: [
    new CopyWebpackPlugin({
      patterns: [
        {
          from: "src/static/*.js",
          to: `${path.resolve(__dirname, "dist", "js")}/[name][ext]`, // è¾“å‡ºåˆ° dist/js/[name][ext]
          // to: path.resolve(__dirname, "dist", "js"), // è¾“å‡ºåˆ° dist/js/src/static/[name][ext]: å³ä¼šæŠŠè¾“å…¥çš„è·¯å¾„å¸¦ä¸Š
        },
        // è¿˜å¯ä»¥ç»§ç»­é…ç½®å…¶å®ƒè¦æ‹·è´çš„æ–‡ä»¶
      ],
    }),
  ],
};
```

æ­¤æ—¶ï¼Œé‡æ–°æ‰§è¡Œ npm run devï¼ŒæŠ¥é”™ä¿¡æ¯å·²ç»æ¶ˆå¤±ã€‚
è¿™é‡Œè¯´ä¸€ä¸‹ flatten è¿™ä¸ªå‚æ•°ï¼Œè®¾ç½®ä¸º trueï¼Œé‚£ä¹ˆå®ƒåªä¼šæ‹·è´æ–‡ä»¶ï¼Œè€Œä¸ä¼šæŠŠæ–‡ä»¶å¤¹è·¯å¾„éƒ½æ‹·è´ä¸Šï¼Œå¤§å®¶å¯ä»¥ä¸è®¾ç½® flatten æ—¶ï¼Œçœ‹ä¸‹æ„å»ºç»“æœã€‚
å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬è¦æ‹·è´ä¸€ä¸ªç›®å½•ä¸‹çš„å¾ˆå¤šæ–‡ä»¶ï¼Œä½†æ˜¯æƒ³è¿‡æ»¤æ‰æŸä¸ªæˆ–æŸäº›æ–‡ä»¶ï¼Œé‚£ä¹ˆ CopyWebpackPlugin è¿˜ä¸ºæˆ‘ä»¬æä¾›äº† ignore å‚æ•°ã€‚

```js
// æ—§ç‰ˆæœ¬å†™æ³•å·²ç»å¤±æ•ˆï¼Œä¸Šé¢å®ä¾‹å°±å¯ä»¥å®ç°è¿™ç§éœ€æ±‚
//webpack.config.js
const CopyWebpackPlugin = require("copy-webpack-plugin");
module.exports = {
  //...
  plugins: [
    new CopyWebpackPlugin(
      [
        {
          from: "public/js/*.js",
          to: path.resolve(__dirname, "dist", "js"),
          flatten: true,
        },
      ],
      {
        ignore: ["other.js"],
      }
    ),
  ],
};
```

ä¾‹å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬å¿½ç•¥æ‰ js ç›®å½•ä¸‹çš„ other.js æ–‡ä»¶ï¼Œä½¿ç”¨ npm run build æ„å»ºï¼Œå¯ä»¥çœ‹åˆ° dist/js ä¸‹ä¸ä¼šå‡ºç° other.js æ–‡ä»¶ã€‚ CopyWebpackPlugin è¿˜æä¾›äº†å¾ˆå¤šå…¶å®ƒçš„å‚æ•°ï¼Œå¦‚æœå½“å‰çš„é…ç½®ä¸èƒ½æ»¡è¶³ä½ ï¼Œå¯ä»¥æŸ¥é˜…æ–‡æ¡£è¿›ä¸€æ­¥ä¿®æ”¹é…ç½®ã€‚

# å‚è€ƒé“¾æ¥

- [webpack å®˜ç½‘](https://www.webpackjs.com/concepts/)
- [webpack ä¸­æ–‡](https://webpack.docschina.org/configuration/dev-server/#root)
- [npm å®˜ç½‘æŸ¥çœ‹å®‰è£…çš„ä¾èµ–](https://www.npmjs.com/package/copy-webpack-plugin)

- [ï¼ï¼ï¼24 ä¸ªå®ä¾‹å…¥é—¨å¹¶æŒæ¡ã€ŒWebpack4ã€(ä¸€)](https://juejin.cn/post/6844903817322954759#heading-5)
- [24 ä¸ªå®ä¾‹å…¥é—¨å¹¶æŒæ¡ã€ŒWebpack4ã€åšå®¢](https://itxiaohao.github.io/passages/webpack4-learn-introduction/)
- [Webpack+Babel æ‰‹æŠŠæ‰‹å¸¦ä½ æ­å»ºå¼€å‘ç¯å¢ƒ(å†…é™„é…ç½®æ–‡ä»¶)](https://cloud.tencent.com/developer/article/1665658)
- [webpack é…ç½® react+antd+ts](https://blog.csdn.net/besttoby01/article/details/106615678)
- [ä½¿ç”¨ webpack5 ä» 0 åˆ° 1 æ­å»ºä¸€ä¸ª react é¡¹ç›®çš„å®ç°æ­¥éª¤](https://www.jb51.net/article/202257.htm)
- [å¸¦ä½ æ·±åº¦è§£é” Webpack ç³»åˆ—(è¿›é˜¶ç¯‡)](https://juejin.cn/post/6844904084927938567)
