# 简介

遇到问题时，一些思考的方向和方法值得记录和思考。

# 重定向

**前端登录链接如何防止链接后加上 redirect 到恶意网站**

风险程度：【高危】
测试地址：http://106.75.253.5/user/login?redirect=http%3A%2F%2Fbaidu.com
问题描述：服务端未对传入的跳转 url 变量进行检查和控制，可能导致可恶意构造任意一个恶意地址，诱导用户跳转到恶意网站。由于是从可信的站点跳转出去的，用户会比较信任，所以跳转漏洞一般用于钓鱼攻击，通过转到恶意网站欺骗用户输入用户名和密码盗取用户信息，或欺骗用户进行金钱交易；也可能引发的 XSS 漏洞（主要是跳转常常使用 302 跳转，即设置 HTTP 响应头，Locatioin: url，如果 url 包含了 CRLF，则可能隔断了 http 响应头，使得后面部分落到了 http body，从而导致 xss 漏洞）。另外在 struts2 中存在重定向的漏洞，是因为 struts2 由于缩写的导航和重定向前缀“action:”、 “redirect:”、 “redirectAction:” 等参数前缀的内容没有被正确过滤导致的开放式重定向漏洞。

测试过程：
访问测试地址，正确填写用户名和密码，验证码。点击登录，登陆成功后自动跳转到百度界面：

该过程中数据包的 refer 字段改变，客户端将根据 refer 将用户重定向到其他网站

**参考修复建议：**
对传入的 URL 做有效性的认证，保证该 URL 来自于信任域。限制的方式可参考以下两种：
1 限制 Referer（Referer 是 HTTP header 中的字段，当浏览器向 web 服务器发送请求时，一般会带上 Referer，告诉服务器是从哪个页面链接过来的），通过限制 Referer 保证将要跳转 URL 的有效性，避免攻击者生成自己的恶意跳转链接；
2 加入有效性验证 Token，保证所有生成的链接都来自于可信域，通过在生成的链接里加入用户不可控的 Token 对生成的链接进行校验。

# Tips

按钮有事件，分为可点击不可点击两种情况，不可点击时 onClick 设置为 undefined 即可。

```jsx
{
  <Button
    onClick={disabled ? undefined : handleAddTasks}
    type="link"
    icon={<PlusOutlined />}
  >
    {i18n.add}
  </Button>;
}
```

## 没菜单时通过输入地址，任然能路由跳转页面

普通用户菜单没有显示，但还是任然能地址栏输入路由跳转相应的页面

所有页面都是在一个 layout 里面显示的，在 layout 里面根据地址和权限判断，不满足就显示空白或者提示。
